<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content=""><meta name="author" content="John Doe"><meta name="keywords" content=""><title>I/O中断 ~ inaho</title><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.10.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.8.7/css/mdb.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css"><link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"><style type="text/css">.banner-bg{background-image:url(/img/bg1.jpg);background-position:center;background-repeat:repeat-y;background-size:cover;background-attachment:fixed}</style><meta name="generator" content="Hexo 4.2.1"></head><body class="banner-bg"><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>阴月有晴</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/">主页</a></li><li class="nav-item"><a class="nav-link" href="/archives/">归档</a></li><li class="nav-item"><a class="nav-link" href="/tags/">标签</a></li><li class="nav-item"><a class="nav-link" href="/about/">关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2 rgba-black-slight" id="background"><div class="full-bg-img"><div class="mask flex-center"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><br><p class="mt-3"><i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp; 星期日, 六月 14日 2020, 4:12 下午</p><p>&nbsp;<i class="far fa-chart-bar"></i> <span class="post-count">2.3k 字 </span>&nbsp; &nbsp;<i class="far fa-clock"></i> <span class="post-count">8 分钟 </span>&nbsp; &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp; <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span> 次 </span>&nbsp;</p></div></div></div></div></header><main id="mainContent" class="rgba-black-slight"><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="py-5 z-depth-3" id="board"><div class="post-content mx-auto" id="post"><div class="markdown-body"><h1 id="输入输出系统的发展概况"><a href="#输入输出系统的发展概况" class="headerlink" title="输入输出系统的发展概况"></a>输入输出系统的发展概况</h1><ul><li>早期，外部设备与主机的连接采用<strong>分散连接</strong>，每一个设备都有专用的控制电路，这些控制电路与CPU的控制电路设计在一起，紧耦合，增加和删除外部设备困难。CPU与IO设备串行工作，主要使用程序查询方式。</li><li>随着外部设备增多，分散连接不适用于外部设备与主机的连接，因此出现了<strong>IO接口与DMA控制器</strong>，连接方式使用<strong>总线连接</strong>，一个总线可以连接多个设备，CPU与IO设备并行工作，出现了两种工作方式分为中断方式、DMA方式。</li><li>为了使输入输出系统的控制尽可能从主机中独立出来，出现了具有<strong>通道结构的阶段</strong>，通道可以看做成小型的DMA控制器，通道有自己的指令系统。</li><li>I/O处理机阶段</li></ul><h1 id="输入输出系统的组成"><a href="#输入输出系统的组成" class="headerlink" title="输入输出系统的组成"></a>输入输出系统的组成</h1><h2 id="IO软件"><a href="#IO软件" class="headerlink" title="IO软件"></a>IO软件</h2><p>IO软件的主要功能: 将用户编制的程序输入主机内，将运算结果输出给用户，实现输入/输出系统与主机工作的协调。</p><h3 id="IO指令"><a href="#IO指令" class="headerlink" title="IO指令"></a>IO指令</h3><p>IO指令分为操作码、命令码和设备码三部分组成，操作码负责IO指令区别其他指令的判别代码，命令码负责I/O的具体操作，设备码用来判断对哪一个设备操作。</p><h3 id="通道指令"><a href="#通道指令" class="headerlink" title="通道指令"></a>通道指令</h3><p>通道指令又称为通道控制字，它是通道用于执行IO操作的指令，可以由管理程序存放在主存的任何地方，由通道从主存中取出并执行。通道程序由通道指令组成，它完成某种外部设备与主存间传送信息的操作。</p><h2 id="IO硬件"><a href="#IO硬件" class="headerlink" title="IO硬件"></a>IO硬件</h2><p>输入/输出系统的硬件组成是多种多样的，在带接口的I/O系统中，I/O硬件包括接口模块和I/O设备两大部分。在具有通道或I/O处理器的I/O系统中，I/O硬件包括通道、设备控制器、IO设备等。</p><h1 id="外部设备"><a href="#外部设备" class="headerlink" title="外部设备"></a>外部设备</h1><p>I/O设备分为: 输入设备、输出设备、输入/输出兼容设备.</p><h2 id="输入设备"><a href="#输入设备" class="headerlink" title="输入设备"></a>输入设备</h2><ul><li>键盘，按下一个键，查出按了哪个键，然后将此键翻译为ASCII码传输给计算机。</li><li>鼠标，光电鼠标内部的发光二极管发出的光线经过表面反射通过一组光学透镜，传输到一个光感应器件内成像，当光电鼠标移动时，其轨迹便会被记录为一组高速拍摄的连贯图像，被光电鼠标内部的专用图形分析芯片处理，完成光标定位。</li></ul><h2 id="输出设备"><a href="#输出设备" class="headerlink" title="输出设备"></a>输出设备</h2><h3 id="阴极射线管-CRT-显示器"><a href="#阴极射线管-CRT-显示器" class="headerlink" title="阴极射线管(CRT)显示器"></a>阴极射线管(CRT)显示器</h3><p>CRT显示器按扫描方式不同 ，分为光栅扫描与随机扫描，按分辨率不同，分为高分辨率和低分辨率。</p><ul><li>分辨率指显示器所能表示的像素个数，分辨率越高，图像越清晰。</li><li>灰度级指黑白显示器中所显示像素点的亮暗差别。</li></ul><p>CRT发光是由电子束打在荧光粉上引起的，电子束扫过之后，发光亮度只能维持几十毫秒，为了使人眼能 看到稳定的图像，必须重复扫描整个屏幕，按人的视觉生理，刷新率大于30次/s时才不会感到闪烁。<br>分辨率为$1024\times 1024$像素，256级灰度的图像，存储容量为<script type="math/tex">1024\times 1024\times log_2(256)=1MB</script></p><h3 id="打印机"><a href="#打印机" class="headerlink" title="打印机"></a>打印机</h3><ul><li>击打式，点阵式(逐字、逐行)</li><li>非击打式，激光、喷墨</li></ul><h1 id="I-O接口"><a href="#I-O接口" class="headerlink" title="I/O接口"></a>I/O接口</h1><h2 id="总线连接方式的I-O接口电路"><a href="#总线连接方式的I-O接口电路" class="headerlink" title="总线连接方式的I/O接口电路"></a>总线连接方式的I/O接口电路</h2><p><img src="/2020/06/14/I-O%E4%B8%AD%E6%96%AD/1.png" srcset="/img/loading.gif" width="280px" height="300px"></p><ul><li>数据线: 用作I/O设备与主机之间传送数据</li><li>设备选择线: 用来传送设备码</li><li>命令线: 用来传输CPU向设备发出的各种命令信号</li><li>状态线: 将I/O设备的状态向主机报告的信号线。</li></ul><h2 id="接口的功能和组成"><a href="#接口的功能和组成" class="headerlink" title="接口的功能和组成"></a>接口的功能和组成</h2><ul><li>选址功能，设备选择电路组成</li><li>传送命令功能，命令寄存器、命令译码器组成</li><li>传送数据功能，数据缓冲寄存器组成</li><li>反映设备状态功能，设备状态标记</li></ul><h2 id="I-O接口的基本组成"><a href="#I-O接口的基本组成" class="headerlink" title="I/O接口的基本组成"></a>I/O接口的基本组成</h2><p><img src="/2020/06/14/I-O%E4%B8%AD%E6%96%AD/2.png" srcset="/img/loading.gif" width="500px" height="180px"></p><h2 id="接口类型"><a href="#接口类型" class="headerlink" title="接口类型"></a>接口类型</h2><ul><li>按数据传送方式分类<ul><li>并行接口</li><li>串行接口</li></ul></li><li>按功能选择的灵活性分类<ul><li>可编程接口</li><li>不可编程接口</li></ul></li><li>按通用性分类<ul><li>通用接口</li><li>专用接口</li></ul></li><li>按数据传送的控制方式分类<ul><li>中断接口</li><li>DMA接口</li></ul></li></ul><h1 id="I-O方式"><a href="#I-O方式" class="headerlink" title="I/O方式"></a>I/O方式</h1><h2 id="程序查询方式"><a href="#程序查询方式" class="headerlink" title="程序查询方式"></a>程序查询方式</h2><p>程序查询方式又称为程序控制I/O方式，这种方式中，数据在CPU与外部设备之间的传输完全靠计算机程序控制，是在CPU主动控制下进行的，当需要输入或输出时，CPU暂停执行主程序，转去执行设备输入输出的服务程序，根据服务程序中的I/O指令进行数据传送。<br>这种方式的缺点在于每时每刻需要不断查询I/O设备是否准备就绪，为了正确完成这种查询，需要执行以下3条指令</p><ul><li>测试指令，用来查询I/O设备是否准备就绪</li><li>转移指令，若I/O设备未准备就绪，则执行转移指令，即转到测试指令，继续测试I/O设备的状态。</li><li>传送指令，若I/O设备准备就绪，则执行传送指令。</li></ul><h2 id="程序中断方式"><a href="#程序中断方式" class="headerlink" title="程序中断方式"></a>程序中断方式</h2><p>CPU启动I/O后，不需要停止现行程序的运行，而I/O接到启动命令后，进入准备阶段，准备就绪，向CPU提出请求，CPU中断现行程序，为I/O服务，这种方式不需要CPU时刻查询I/O设备的状态，一次中断处理过程归纳为5个阶段:</p><ul><li>中断请求、中断判优、中断响应、中断服务、中断返回</li></ul><h2 id="DMA方式"><a href="#DMA方式" class="headerlink" title="DMA方式"></a>DMA方式</h2><p>DMA方式是一种完全由硬件进行成组信息传送的控制方式，数据准备阶段，CPU与外设并行，还降低了CPU在传送数据时的开销，因为信息传送不经过CPU，而在外设和内存之间直接进行。</p><h3 id="DMA的传送方法"><a href="#DMA的传送方法" class="headerlink" title="DMA的传送方法"></a>DMA的传送方法</h3><p>如果高速I/O(通过DMA接口)和CPU同时访存，这时CPU需要将总线占有权让给DMA接口使用，通常DMA与主存交换数据采用以下三种方法。</p><h4 id="停止CPU访问主存"><a href="#停止CPU访问主存" class="headerlink" title="停止CPU访问主存"></a>停止CPU访问主存</h4><p>DMA接口向CPU发一个信号，要求CPU放弃地总线使用权，然后DMA获得总线控制权后，开始进行数据传送，数据传输后，DMA接口通知CPU可以使用主存，并把总线控制权还给CPU。</p><h4 id="周期挪用"><a href="#周期挪用" class="headerlink" title="周期挪用"></a>周期挪用</h4><p>当I/O设备由DMA请求时，会遇到3种情况:</p><ul><li>CPU不在访存，故CPU与IO访存请求未冲突</li><li>CPU正在访存，等待存储周期结束后，CPU再将总线占有权让出</li><li>CPU与IO同时访存，此刻CPU要暂时放弃总线占有权，由I/O设备挪用一个或几个存储周期，这种方式既实现了I/O传送，又较好的发挥了主存与CPU的效率。</li></ul><h4 id="DMA与CPU交替访问"><a href="#DMA与CPU交替访问" class="headerlink" title="DMA与CPU交替访问"></a>DMA与CPU交替访问</h4><p>这种方式适用于CPU工作周期比主存存取周期长的情况，不需要总线使用权的申请、建立和归还过程，总线使用权分时控制。</p><h3 id="DMA接口的功能和组成"><a href="#DMA接口的功能和组成" class="headerlink" title="DMA接口的功能和组成"></a>DMA接口的功能和组成</h3><h4 id="DMA接口的功能"><a href="#DMA接口的功能" class="headerlink" title="DMA接口的功能"></a>DMA接口的功能</h4><ul><li>向CPU申请DMA传送</li><li>处理总线控制权的转交</li><li>管理系统总线、控制数据传送</li><li>确定数据传送的首地址和长度，修正传送过程中的数据地址和长度</li><li>DMA传送结束时，给出操作完成信号。</li></ul><h4 id="DMA接口组成"><a href="#DMA接口组成" class="headerlink" title="DMA接口组成"></a>DMA接口组成</h4><p><img src="/2020/06/14/I-O%E4%B8%AD%E6%96%AD/3.png" srcset="/img/loading.gif" width="500px" height="300px"></p><h3 id="DMA工作过程"><a href="#DMA工作过程" class="headerlink" title="DMA工作过程"></a>DMA工作过程</h3><h4 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h4><p>DMA接口开始工作前，CPU必须做如下工作:</p><ul><li>指明是输入数据还是输出数据</li><li>向DMA设备地址寄存器送入设备号，并启动设备</li><li>向DMA主存地址寄存器送入交换数据的主存首地址</li><li>对字计数器赋予交换数据的个数</li></ul><h4 id="数据传送"><a href="#数据传送" class="headerlink" title="数据传送"></a>数据传送</h4><p>DMA是以数据块为单位传送的，具体流程如下:</p><ul><li>准备好一个字时，将该字读到DMA的数据缓冲寄存器中,表示数据缓冲寄存器满。</li><li>设备同时向DMA接口发请求</li><li>DMA接口向CPU申请总线控制权</li><li>CPU发出HLDA信号，表示允许将总线控制权交给DMA接口</li><li>将DMA主存地址寄存器中的主存地址送地址总线，并命令存储器写</li><li>DMA控制逻辑告诉I/O，CPU已经安排了DMA周期，记住为下一个字的传送做准备</li><li>将DMA数据缓冲寄存器的内容送数据总线</li><li>主存将数据总线上的信息写至地址总线指定的存储单元中。</li><li>修改主存地址和字计数值。</li></ul><h4 id="后处理"><a href="#后处理" class="headerlink" title="后处理"></a>后处理</h4><p>当DMA中断请求得到响应后，CPU停止原程序执行，转去执行中断服务程序，做一些DMA的结束工作。</p><hr></div><br><div><p><span><i class="iconfont icon-tag"></i> <a class="hover-with-bg" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86">计算机组成原理</a></span></p><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p><div class="col-lg-7 mx-auto nopadding-md"><div class="container comments mx-auto" id="comments"><br><br><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="http://yoursite.com/2020/06/14/I-O中断/",this.page.identifier="/2020/06/14/I-O中断/"},oldLoad=window.onload;window.onload=function(){var t=document,e=t.createElement("script");e.type="text/javascript",e.src="//inaho-top.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noopener">comments powered by Disqus.</a></noscript></div></div></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container"><div id="toc"><p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a class="z-depth-1" id="scroll-top-button" href="#" role="button"><i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div id="footerContent" class="rgba-black-slight"><footer class="pt-5"><div style="color:#fff" class="text-center py-3"><a style="color:#fff" href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo支持</b></a> <i class="iconfont icon-love"></i> <a style="color:#fff" href="https://disqus.com/" target="_blank" rel="nofollow noopener"><b>Disqus 评论系统 </b></a><i class="iconfont icon-love"></i> <a style="color:#fff" href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><b>主题Fluid </b></a><i class="iconfont icon-love"></i> <a style="color:#fff" href="https://www.pixiv.net/" target="_blank" rel="nofollow noopener"><b>图片 Pixiv</b></a><br>&nbsp;<span id="busuanzi_container_site_pv">总访问量 <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp; &nbsp;<span id="busuanzi_container_site_uv">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;<br></div></footer></div><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="/lib/popper/popper.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script><script src="https://cdn.staticfile.org/mdbootstrap/4.8.7/js/mdb.min.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="/lib/tocbot/tocbot.min.js"></script><script src="/js/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/lib/prettify/prettify.min.js"></script><script>$(document).ready((function(){$("pre").addClass("prettyprint  linenums"),prettyPrint()}))</script><script src="/lib/typed/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","I/O中断&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready((function(){$(".typed-cursor").addClass("h2"),typed.start()}))</script><script src="https://cdn.staticfile.org/anchor-js/4.2.0/anchor.min.js"></script><script>anchors.options={placement:"right",visible:"false"};var el="h1,h2,h3,h4,h5,h6".split(","),res=[];for(item of el)res.push(".markdown-body > "+item);anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){getSearchFile(path),this.onclick=null}</script><script src="/lib/fancybox/jquery.fancybox.min.js"></script><script>$("#post img:not(.no-zoom img, img[no-zoom])").each((function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)}))</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
              processEscapes: true,
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
      });

      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });</script><script src="https://cdn.staticfile.org/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript">$("#background").removeClass("banner-bg"),$("body").addClass("banner-bg");var postToTopHight=$("#board").offset().top;$(window).scroll((function(){document.body.scrollTop+document.documentElement.scrollTop>=postToTopHight?($("#background").removeClass("rgba-black-slight"),$("#mainContent").removeClass("rgba-black-slight"),$("#footerContent").removeClass("rgba-black-slight")):($("#background").addClass("rgba-black-slight"),$("#mainContent").addClass("rgba-black-slight"),$("#footerContent").addClass("rgba-black-slight"))}))</script></body></html>