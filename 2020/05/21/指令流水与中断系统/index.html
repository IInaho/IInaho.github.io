<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content=""><meta name="author" content="John Doe"><meta name="keywords" content=""><title>指令流水与中断系统 ~ inaho</title><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.10.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.8.7/css/mdb.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css"><link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"><style type="text/css">.banner-bg{background-image:url(/img/bg1.jpg);background-position:center;background-repeat:repeat-y;background-size:cover;background-attachment:fixed}</style><meta name="generator" content="Hexo 4.2.0"></head><body class="banner-bg"><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>阴月有晴</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/">主页</a></li><li class="nav-item"><a class="nav-link" href="/archives/">归档</a></li><li class="nav-item"><a class="nav-link" href="/tags/">标签</a></li><li class="nav-item"><a class="nav-link" href="/about/">关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2 rgba-black-slight" id="background"><div class="full-bg-img"><div class="mask flex-center"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><br><p class="mt-3"><i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp; 星期四, 五月 21日 2020, 11:47 中午</p><p>&nbsp;<i class="far fa-chart-bar"></i> <span class="post-count">3.3k 字 </span>&nbsp; &nbsp;<i class="far fa-clock"></i> <span class="post-count">11 分钟 </span>&nbsp; &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp; <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span> 次 </span>&nbsp;</p></div></div></div></div></header><main id="mainContent" class="rgba-black-slight"><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="py-5 z-depth-3" id="board"><div class="post-content mx-auto" id="post"><div class="markdown-body"><h1 id="指令流水"><a href="#指令流水" class="headerlink" title="指令流水"></a>指令流水</h1><h2 id="如何提高机器速度"><a href="#如何提高机器速度" class="headerlink" title="如何提高机器速度"></a>如何提高机器速度</h2><ul><li>提高访存速度<ul><li>高速存储芯片</li><li>高速Cachhe</li><li>多体并行结构</li></ul></li><li>提高I/O和主机之间的传送速度<ul><li>中断</li><li>DMA</li><li>通道</li><li>I/O处理机</li><li>多总线结构</li></ul></li><li>提高运算器速度<ul><li>高速芯片</li><li>改进算法</li><li>快速进位链</li></ul></li><li>提高整机处理能力<ul><li>高速器件</li><li>改进系统结构，开发系统的并行性</li></ul></li></ul><h3 id="系统的并行性"><a href="#系统的并行性" class="headerlink" title="系统的并行性"></a>系统的并行性</h3><h4 id="并行的概念"><a href="#并行的概念" class="headerlink" title="并行的概念"></a>并行的概念</h4><ul><li>并发，两个或两个以上事件在同一时间段发生</li><li>同时，两个或两个以上事件在同一时刻发生</li></ul><h3 id="并行性的等级"><a href="#并行性的等级" class="headerlink" title="并行性的等级"></a>并行性的等级</h3><ul><li>过程级(程序、进程)，粗粒度，软件实现。</li><li>指令级(指令之间，指令内部)，细粒度，硬件实现。</li></ul><h2 id="指令流水的原理"><a href="#指令流水的原理" class="headerlink" title="指令流水的原理"></a>指令流水的原理</h2><h3 id="指令的串行执行"><a href="#指令的串行执行" class="headerlink" title="指令的串行执行"></a>指令的串行执行</h3><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/1.png" srcset="/img/loading.gif" width="600px" height="60px"><br>一条指令的执行需要经过三个阶段，取指令、译码、执行，每个阶段都需要花费一个时钟周期，如果没有采用流水线技术，那么执行N条这样的指令就需要3N个时钟周期，假设取指令用取指令部件完成，执行指令用执行指令部件完成，那么总有一个部件空闲，如图所示。</p><h3 id="指令的二级流水"><a href="#指令的二级流水" class="headerlink" title="指令的二级流水"></a>指令的二级流水</h3><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/2.png" srcset="/img/loading.gif" width="300px" height="100px"></p><p>若取指和执行阶段时间上完全重叠，在执行指令1时，取指令部件空闲，用来取指令2，这样可以使指令周期减半，速度提高一倍。</p><h3 id="影响指令流水效率加倍的因素"><a href="#影响指令流水效率加倍的因素" class="headerlink" title="影响指令流水效率加倍的因素"></a>影响指令流水效率加倍的因素</h3><h4 id="执行时间-gt-取指时间"><a href="#执行时间-gt-取指时间" class="headerlink" title="执行时间 &gt; 取指时间"></a>执行时间 &gt; 取指时间</h4><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/3.png" srcset="/img/loading.gif" width="400px" height="100px"></p><h4 id="条件转移指令对指令流水的影响"><a href="#条件转移指令对指令流水的影响" class="headerlink" title="条件转移指令对指令流水的影响"></a>条件转移指令对指令流水的影响</h4><p>必须等上条指令执行结束，才能确定下条指令的地址，造成了时间损失，可以采用猜测法，先不管执行结果，指令部件仍按顺序预取下一条指令，这样，如果条件不成立，转移没有发生，则没有时间损失，若条件成立，转移发生，则所取的指令必须丢掉，再取新的指令。</p><h3 id="指令的六级流水"><a href="#指令的六级流水" class="headerlink" title="指令的六级流水"></a>指令的六级流水</h3><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/4.png" srcset="/img/loading.gif" width="600px" height="300px"></p><p>将指令周期分为取指令(FI)、指令移码(ID)、计算操作数地址(CO)、取操作数(FO)、执行指令(EI)、写操作数(WO)6个阶段，形成了六级流水，完成一条指令需要6个时间单位，串行执行总共需要$6\times 9=54$个时间单位，六级流水需要14个时间单位。</p><h3 id="影响指令流水线性能的因素"><a href="#影响指令流水线性能的因素" class="headerlink" title="影响指令流水线性能的因素"></a>影响指令流水线性能的因素</h3><h4 id="结构相关"><a href="#结构相关" class="headerlink" title="结构相关"></a>结构相关</h4><p>不同指令争用同一功能部件产生资源冲突，如下图，指令1与指令4冲突，指令2与指令5冲突，指令1、3、6冲突<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/5.png" srcset="/img/loading.gif" width="600px" height="300px"></p><p>解决办法：</p><ul><li>停顿法，等前面的指令完成操作，后面的指令在进行操作</li><li>指令存储器和数据存储器分开</li><li>指令预取技术，设置缓冲区，空闲的单位提前缓存数据或读取数据，适用于访存周期短的情况</li></ul><h4 id="数据相关"><a href="#数据相关" class="headerlink" title="数据相关"></a>数据相关</h4><p>在一个程序中，如果必须等前一条指令执行完毕后，后一条指令需要前一条指令执行的结果才能执行，那么这两条指令就是数据相关，不同指令因重叠操作，可能改变操作数的读/写，访问顺序.<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/6.png" srcset="/img/loading.gif" width="450px" height="200px"></p><p>解决办法： 后推法，采用旁路技术，旁路技术就是操作结果出来后，直接送入下一条指令，不需要先存入寄存器。</p><h4 id="控制相关"><a href="#控制相关" class="headerlink" title="控制相关"></a>控制相关</h4><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/7.png" srcset="/img/loading.gif" width="300px" height="150px"></p><p>控制相关冲突由转移指令引起，当执行转移指令时，依据转移条件的产生结果，可能顺序执行下一条指令，也可能转移到新的目标地址取指令，从而使流水线发生断流。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/8.png" srcset="/img/loading.gif" width="600px" height="300px"></p><p>解决办法：采用猜测法技术，机器先选定转义分支中的一个，按它取指并处理，条件码生成后，如果猜测正确，那么流水线继续进行下去，如果猜测错误，那么之前预取的指令失效。</p><h2 id="流水线性能"><a href="#流水线性能" class="headerlink" title="流水线性能"></a>流水线性能</h2><h3 id="吞吐率"><a href="#吞吐率" class="headerlink" title="吞吐率"></a>吞吐率</h3><p>单位时间内流水线所完成指令或输出结果的数量</p><ul><li>设m段的流水线各段时间为Δt</li><li>最大吞吐率$T_{pmax} = 1/Δt$</li><li>实际吞吐率，连续处理n条指令的吞吐率为$T_p=n/(mΔt+(n-1)Δt)$</li></ul><h3 id="加速比-S-p"><a href="#加速比-S-p" class="headerlink" title="加速比$S_p$"></a>加速比$S_p$</h3><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/9.png" srcset="/img/loading.gif" width="600px" height="300px"><br>流水线中各功能段的利用率，由于流水线有建立时间和排空时间，因此各功能段的设备不可能一直处在工作状态,效率就是流水线中各功能段的利用率.<br>效率 = 流水线各段处于工作时间的时空区/流水线中各段总的时空区$= mnΔt/m(m+n-1)Δt$</p><h2 id="流水线的多发技术"><a href="#流水线的多发技术" class="headerlink" title="流水线的多发技术"></a>流水线的多发技术</h2><h3 id="超标量技术"><a href="#超标量技术" class="headerlink" title="超标量技术"></a>超标量技术</h3><ul><li>每个时钟周期内可并发多条独立指令，配置多个功能部件</li><li>不能调整指令的执行顺序，通过编译优化技术，把可并行执行的指令搭配起来<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/10.png" srcset="/img/loading.gif" width="600px" height="200px"></li></ul><h3 id="超流水线技术"><a href="#超流水线技术" class="headerlink" title="超流水线技术"></a>超流水线技术</h3><ul><li>在一个时钟周期内再分段，在一个时钟周期内一个功能部件使用多次</li><li>不能调整指令的执行顺序，靠编译程序解决优化问题<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/11.png" srcset="/img/loading.gif" width="600px" height="200px"></li></ul><h3 id="超长指令字技术"><a href="#超长指令字技术" class="headerlink" title="超长指令字技术"></a>超长指令字技术</h3><ul><li>由编译程序挖掘出指令间潜在的并行性，将多条能并行操作的指令组合成一条具有多个操作码字段的超长指令字。</li><li>采用多个处理部件<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/12.png" srcset="/img/loading.gif" width="600px" height="200px"></li></ul><h3 id="动态流水线"><a href="#动态流水线" class="headerlink" title="动态流水线"></a>动态流水线</h3><p>动态流水线就是多种运算可以同时进行，而静态流水线只能是一种运算进行完在进行下一种运算。</p><h2 id="流水线结构"><a href="#流水线结构" class="headerlink" title="流水线结构"></a>流水线结构</h2><h3 id="指令流水线结构"><a href="#指令流水线结构" class="headerlink" title="指令流水线结构"></a>指令流水线结构</h3><p>完成一条指令分6段，每段需要一个时钟周期。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/13.png" srcset="/img/loading.gif" width="400px" height="180px"></p><p>若流水线不出现断流，一个时钟周期出一个结果，不采用流水技术，6个时钟周期出一个结果，理想情况下，6级流水的速度是不采用流水技术的6倍。</p><h3 id="运算流水线"><a href="#运算流水线" class="headerlink" title="运算流水线"></a>运算流水线</h3><p>完成浮点加减运算，可分对阶、尾数求和、规格化三段，每段操作时间尽量一致。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/14.png" srcset="/img/loading.gif" width="400px" height="230px"></p><h1 id="中断系统"><a href="#中断系统" class="headerlink" title="中断系统"></a>中断系统</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="引起中断的各种因素"><a href="#引起中断的各种因素" class="headerlink" title="引起中断的各种因素"></a>引起中断的各种因素</h3><ol><li>人为设置的中断，如转管指令。</li><li>程序性事故，溢出、操作码不能识别、除法非法</li><li>硬件故障</li><li>I/O设备</li><li>外部事件，用键盘中断现行程序</li></ol><h3 id="中断系统需要解决的问题"><a href="#中断系统需要解决的问题" class="headerlink" title="中断系统需要解决的问题"></a>中断系统需要解决的问题</h3><ol><li>各中断源如何向CPU提出请求？</li><li>各中断源同时提出请求怎么办？</li><li>CPU什么条件、什么时间、以什么方式响应中断？</li><li>如何保护现场？</li><li>如何寻找入口地址?</li><li>如何恢复现场，如何返回？</li><li>处理中断的过程中又出现新的中断怎么办？</li></ol><h2 id="中断请求标记和中断判优逻辑"><a href="#中断请求标记和中断判优逻辑" class="headerlink" title="中断请求标记和中断判优逻辑"></a>中断请求标记和中断判优逻辑</h2><h3 id="中断请求标记-INTR"><a href="#中断请求标记-INTR" class="headerlink" title="中断请求标记(INTR)"></a>中断请求标记(INTR)</h3><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/15.png" srcset="/img/loading.gif" width="400px" height="180px"><br>如何向CPU提出请求，给每一个中断源，配置一个INTR中断请求标记触发器，来判断是否发出了中断请求，多个中断源有多个INTR，这些INTR逻辑上组成了中断请求标记寄存器。<br>INTR可以分散在各个中断源的接口电路中，也可以集中在CPU的中断系统内。</p><h3 id="中断判优逻辑"><a href="#中断判优逻辑" class="headerlink" title="中断判优逻辑"></a>中断判优逻辑</h3><ol><li>硬件实现(排队器)<ul><li>分散在各个中断源的接口电路中，使用链式排队器实现</li><li>集中在CPU内<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/16.png" srcset="/img/loading.gif" width="400px" height="230px"><br>图中INTR_1=1，就可以封住比它级别低的中断源请求，INTR_1=1经过非门电路，会变成0信号，那么通过中间那根线传递给INTR_2等的都是0信号，”&amp;”与门，只要输入端有”0”信号就过不去，所以INTR_1=1时可以封住比它级别低的中断源的请求。</li></ul></li><li>软件实现<br>软件实现中断判优只需要写一段程序，并按中断源的优先等级从高至低逐级查询各中断源是否有中断请求，这样就可以保证CPU首先响应级别高的中断源请求。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/17.png" srcset="/img/loading.gif" width="400px" height="230px"></li></ol><h3 id="中断服务程序入口地址的寻找"><a href="#中断服务程序入口地址的寻找" class="headerlink" title="中断服务程序入口地址的寻找"></a>中断服务程序入口地址的寻找</h3><h4 id="硬件向量法"><a href="#硬件向量法" class="headerlink" title="硬件向量法"></a>硬件向量法</h4><p>利用硬件产生中断向量地址，再由向量地址找到中断服务程序入口地址，向量地址是由中断向量地址形成部件产生的，如何通过向量地址找到中断服务程序入口地址？</p><ul><li>当CPU响应中断时，将向量地址送至PC，执行这条指令，便可无条件转向某服务程序的入口地址。</li><li>设置向量地址表，该表存放在存储单元内，存储单元的地址为向量地址，存储单元内容为中断服务程序入口地址，即中断向量，访问向量地址所指示的存储单元，便可获得入口地址。</li></ul><h4 id="软件查询法"><a href="#软件查询法" class="headerlink" title="软件查询法"></a>软件查询法</h4><p>查询到某一中断请求时，接着安排一条转移指令，直接指向此中断源的中断服务程序入口地址，机器便自动进入中断处理，中断源对应入口地址，由程序员或系统事先确定，下图举例。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/18.png" srcset="/img/loading.gif" width="400px" height="230px"></p><blockquote><p>M是入口地址，SKP是跳过下一条指令，判断D是0还是1</p></blockquote><h3 id="中断响应"><a href="#中断响应" class="headerlink" title="中断响应"></a>中断响应</h3><ol><li>响应中断的条件：图中有一个关中断操作，或者称为允许中断触发器EINT，它可被开中断指令置1，也可被关中断指令置0，当允许中断触发器为1时，意味着CPU允许响应中断源的请求，为0时，意味着CPU禁止响应中断。</li><li>响应中断的时间：指令执行周期结束时刻由CPU发查询信号，如果由则进入中断周期，如果没有，则进行下一条指令的取指周期。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/19.png" srcset="/img/loading.gif" width="400px" height="330px"></li></ol><h3 id="中断隐指令"><a href="#中断隐指令" class="headerlink" title="中断隐指令"></a>中断隐指令</h3><ol><li>保护程序断点<br>保护程序断点就是将当前PC的内容保存到特定地址内，也可以存入堆栈</li><li>寻找服务程序入口地址<ul><li>向量地址-&gt;PC (硬件向量法)</li><li>终端识别程序入口地址M-&gt;PC (软件查询法)</li></ul></li><li>硬件关中断<br>CPU进入中断周期意味着CPU响应了某个中断源的请求，为了确保CPU响应该中断后所做的一系列操作不至于再受到新的中断请求的干扰，在该中断周期内必须自动关中断，已禁止CPU再次响应新的中断请求。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/20.png" srcset="/img/loading.gif" width="400px" height="200px"></li></ol><blockquote><p>INT中断标记，EINT允许中断，R-S触发器，单重中断：执行中断服务程序时不允许再发生中断，多重中断：保护程序软硬件状态的过程中，不允许发生中断。</p></blockquote><h3 id="保护现场和恢复现场"><a href="#保护现场和恢复现场" class="headerlink" title="保护现场和恢复现场"></a>保护现场和恢复现场</h3><ul><li>保护现场<ul><li>断点，中断隐指令完成</li><li>寄存器内容，中断服务程序完成</li></ul></li><li>恢复现场，中断服务程序完成<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/21.png" srcset="/img/loading.gif" width="400px" height="230px"></li></ul><h3 id="多重中断"><a href="#多重中断" class="headerlink" title="多重中断"></a>多重中断</h3><h4 id="多重中断的概念"><a href="#多重中断的概念" class="headerlink" title="多重中断的概念"></a>多重中断的概念</h4><p>当CPU正在执行某个中断服务程序时，另一个中断源右提出了新的中断请求，而CPU又响应了这个新的请求，于是暂停正在运行的中断服务程序，转去执行新的中断服务程序，这称为多重中断，又称为中断嵌套。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/22.png" srcset="/img/loading.gif" width="300px" height="250px"></p><h4 id="实现多重中断的条件"><a href="#实现多重中断的条件" class="headerlink" title="实现多重中断的条件"></a>实现多重中断的条件</h4><ul><li>提前设置开中断指令</li><li>优先级别高的中断源有权中断优先级别高低的中断源<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/23.png" srcset="/img/loading.gif" width="400px" height="250px"></li></ul><h3 id="屏蔽技术"><a href="#屏蔽技术" class="headerlink" title="屏蔽技术"></a>屏蔽技术</h3><h4 id="屏蔽触发器的作用"><a href="#屏蔽触发器的作用" class="headerlink" title="屏蔽触发器的作用"></a>屏蔽触发器的作用</h4><p>每个中断请求触发器都有一个屏蔽触发器，将所有屏蔽触发器组合在一起，便构成了一个屏蔽寄存器，屏蔽寄存器的内容称为屏蔽字，每个中断源都对应一个屏蔽字。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/24.png" srcset="/img/loading.gif" width="400px" height="180px"></p><blockquote><p>MASK=0表示未屏蔽，$MASK_i$表示屏蔽，INTR能被置1，$INTP_i$=0表示不能被排队选中。</p></blockquote><h4 id="屏蔽字"><a href="#屏蔽字" class="headerlink" title="屏蔽字"></a>屏蔽字</h4><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/25.png" srcset="/img/loading.gif" width="400px" height="250px"></p><p>图中可以看出，优先级为5的屏蔽字00001111111111111111表示1、2、3、4都是比它优先级高的，这16位二进制数分别对应16个中断源。</p><h4 id="屏蔽技术可改变处理优先级"><a href="#屏蔽技术可改变处理优先级" class="headerlink" title="屏蔽技术可改变处理优先级"></a>屏蔽技术可改变处理优先级</h4><ul><li>响应优先级，不可改变</li><li>处理优先级，可改变(通过重新设置屏蔽字)</li></ul><p><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/26.png" srcset="/img/loading.gif" width="400px" height="200px"></p><p>响应优先级A-&gt;B-&gt;C-&gt;D降序排列<br>处理优先级A-&gt;D-&gt;C-&gt;B降序排列</p><p>CPU执行程序轨迹(原屏蔽字)：<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/27.png" srcset="/img/loading.gif" width="400px" height="180px"></p><p>CPU执行程序轨迹(新屏蔽字)：<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/28.png" srcset="/img/loading.gif" width="400px" height="180px"></p><blockquote><p>可以人为地屏蔽某个中断源地请求</p></blockquote><h4 id="新屏蔽字地设置"><a href="#新屏蔽字地设置" class="headerlink" title="新屏蔽字地设置"></a>新屏蔽字地设置</h4><p>保护现场-&gt;设置屏蔽字-开中断-中断服务-关中断-恢复现场-恢复屏蔽字-开中断-中断返回</p><blockquote><p>设置屏蔽字一定在开中断之前。</p></blockquote><h4 id="多重中断地断点保护"><a href="#多重中断地断点保护" class="headerlink" title="多重中断地断点保护"></a>多重中断地断点保护</h4><ol><li>断点进栈，中断隐指令完成</li><li>断点存入”0”地址，中断隐指令完成</li><li>程序断点存入”0”地址的断点保护<br>如果进行三次中断，三个断点都存入”0”地址，为了保证断点不丢失，进行断点保护。<br><img src="/2020/05/21/%E6%8C%87%E4%BB%A4%E6%B5%81%E6%B0%B4%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F/29.png" srcset="/img/loading.gif" width="400px" height="250px"></li></ol><hr></div><br><div><p><span><i class="iconfont icon-tag"></i> <a class="hover-with-bg" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86">计算机组成原理</a></span></p><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p><div class="col-lg-7 mx-auto nopadding-md"><div class="container comments mx-auto" id="comments"><br><br><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="http://yoursite.com/2020/05/21/指令流水与中断系统/",this.page.identifier="/2020/05/21/指令流水与中断系统/"},oldLoad=window.onload;window.onload=function(){var t=document,e=t.createElement("script");e.type="text/javascript",e.src="//inaho-top.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noopener">comments powered by Disqus.</a></noscript></div></div></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container"><div id="toc"><p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a class="z-depth-1" id="scroll-top-button" href="#" role="button"><i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div id="footerContent" class="rgba-black-slight"><footer class="pt-5"><div style="color:#fff" class="text-center py-3"><a style="color:#fff" href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo支持</b></a> <i class="iconfont icon-love"></i> <a style="color:#fff" href="https://disqus.com/" target="_blank" rel="nofollow noopener"><b>Disqus 评论系统 </b></a><i class="iconfont icon-love"></i> <a style="color:#fff" href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><b>主题Fluid </b></a><i class="iconfont icon-love"></i> <a style="color:#fff" href="https://www.pixiv.net/" target="_blank" rel="nofollow noopener"><b>图片 Pixiv</b></a><br>&nbsp;<span id="busuanzi_container_site_pv">总访问量 <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp; &nbsp;<span id="busuanzi_container_site_uv">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;<br></div></footer></div><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="/lib/popper/popper.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script><script src="https://cdn.staticfile.org/mdbootstrap/4.8.7/js/mdb.min.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="/lib/tocbot/tocbot.min.js"></script><script src="/js/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/lib/prettify/prettify.min.js"></script><script>$(document).ready(function(){$("pre").addClass("prettyprint  linenums"),prettyPrint()})</script><script src="/lib/typed/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","指令流水与中断系统&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.0/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){getSearchFile(path),this.onclick=null}</script><script src="/lib/fancybox/jquery.fancybox.min.js"></script><script>$("#post img:not(.no-zoom img, img[no-zoom])").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
              processEscapes: true,
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
      });

      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });</script><script src="https://cdn.staticfile.org/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript">$("#background").removeClass("banner-bg"),$("body").addClass("banner-bg");var postToTopHight=$("#board").offset().top;$(window).scroll(function(){var o=document.body.scrollTop+document.documentElement.scrollTop;postToTopHight<=o?($("#background").removeClass("rgba-black-slight"),$("#mainContent").removeClass("rgba-black-slight"),$("#footerContent").removeClass("rgba-black-slight")):($("#background").addClass("rgba-black-slight"),$("#mainContent").addClass("rgba-black-slight"),$("#footerContent").addClass("rgba-black-slight"))})</script></body></html>