<!DOCTYPE html>
<html lang="zh-cn">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
MySQL 入门 · inaho
</title>
  





<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">





<meta name="author" content="inaho">
<meta name="description" content="
  MySQL 入门
  
    
    链接到标题
  


  MYSQL 入门知识
  
    
    链接到标题
  

此文是阅读 MYSQL 必知必会后整理的所有样例代码，仅供自用。

  一、MySQL 基础命令
  
    
    链接到标题
  

use database;               -- 打开数据库
show databases;           -- 列出所有数据库
show tables;                -- 列出数据库所有表
show columns from orders; -- 列出表内所有的列
describe orders;           -- 列出表内所有的列
show status;               -- 显示广泛的服务器状态信息


  二、检索数据
  
    
    链接到标题
  

USE sqltest;                                        -- 使用数据库
SELECT prod_name FROM products;
SELECT prod_id,prod_name,prod_price FROM products;    -- 返回多列
SELECT * FROM products;                                -- 返回所有列
SELECT DISTINCT vend_id FROM products;                -- 只返回不同的值，DISTINCT不能部分使用，其应用于所有列
SELECT prod_name FROM products LIMIT 5;                -- 返回不多于5行
SELECT prod_name FROM products LIMIT 5,5;            -- 返回从行5开始的5行，检索出的第一行为行0
SELECT prod_name FROM products LIMIT 4 OFFSET 3;    -- 从行3开始取4行
SELECT products.prod_name FROM products;            -- 使用完全限定的表名


  三、排序检索数据
  
    
    链接到标题
  

SELECT prod_name FROM products ORDER BY prod_name;    -- 对prod_name以字母顺序排序
-- 多个行具有相同prod_price时，才对产品按prod_name进行排序，如果prod_price所有值唯一，则不会按prod_name排序。
SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price,prod_name;    -- 首先对价格排序，在按名称排序
-- 默认进行升序排序，也可以指定ASC进行升序排序，但没必要
SElECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC;        -- 对价格降序排序
-- 如果要对每个列进行降序排序，要对每个列指定DESC
SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC, prod_name;    -- 先对价格降序排序，在对名称排序
-- ORDER BY必须在FROM子句之后，LIMIT必须在ORDER BY子句之后
SELECT prod_price FROM products ORDER BY prod_price DESC LIMIT 1;        -- 找出最贵的价格


  四、过滤数据
  
    
    链接到标题
  

ORDER BY 子句位于 WHERE 之后">
<meta name="keywords" content="blog,developer,personal">






  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="MySQL 入门">
  <meta name="twitter:description" content="MySQL 入门 链接到标题 MYSQL 入门知识 链接到标题 此文是阅读 MYSQL 必知必会后整理的所有样例代码，仅供自用。
一、MySQL 基础命令 链接到标题 use database; -- 打开数据库 show databases; -- 列出所有数据库 show tables; -- 列出数据库所有表 show columns from orders; -- 列出表内所有的列 describe orders; -- 列出表内所有的列 show status; -- 显示广泛的服务器状态信息 二、检索数据 链接到标题 USE sqltest; -- 使用数据库 SELECT prod_name FROM products; SELECT prod_id,prod_name,prod_price FROM products; -- 返回多列 SELECT * FROM products; -- 返回所有列 SELECT DISTINCT vend_id FROM products; -- 只返回不同的值，DISTINCT不能部分使用，其应用于所有列 SELECT prod_name FROM products LIMIT 5; -- 返回不多于5行 SELECT prod_name FROM products LIMIT 5,5; -- 返回从行5开始的5行，检索出的第一行为行0 SELECT prod_name FROM products LIMIT 4 OFFSET 3; -- 从行3开始取4行 SELECT products.prod_name FROM products; -- 使用完全限定的表名 三、排序检索数据 链接到标题 SELECT prod_name FROM products ORDER BY prod_name; -- 对prod_name以字母顺序排序 -- 多个行具有相同prod_price时，才对产品按prod_name进行排序，如果prod_price所有值唯一，则不会按prod_name排序。 SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price,prod_name; -- 首先对价格排序，在按名称排序 -- 默认进行升序排序，也可以指定ASC进行升序排序，但没必要 SElECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC; -- 对价格降序排序 -- 如果要对每个列进行降序排序，要对每个列指定DESC SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC, prod_name; -- 先对价格降序排序，在对名称排序 -- ORDER BY必须在FROM子句之后，LIMIT必须在ORDER BY子句之后 SELECT prod_price FROM products ORDER BY prod_price DESC LIMIT 1; -- 找出最贵的价格 四、过滤数据 链接到标题 ORDER BY 子句位于 WHERE 之后">
 
<meta property="og:url" content="//localhost:1313/posts/c5gpdfxoio6edjxctrhchq49n6f/">
  <meta property="og:site_name" content="inaho">
  <meta property="og:title" content="MySQL 入门">
  <meta property="og:description" content="MySQL 入门 链接到标题 MYSQL 入门知识 链接到标题 此文是阅读 MYSQL 必知必会后整理的所有样例代码，仅供自用。
一、MySQL 基础命令 链接到标题 use database; -- 打开数据库 show databases; -- 列出所有数据库 show tables; -- 列出数据库所有表 show columns from orders; -- 列出表内所有的列 describe orders; -- 列出表内所有的列 show status; -- 显示广泛的服务器状态信息 二、检索数据 链接到标题 USE sqltest; -- 使用数据库 SELECT prod_name FROM products; SELECT prod_id,prod_name,prod_price FROM products; -- 返回多列 SELECT * FROM products; -- 返回所有列 SELECT DISTINCT vend_id FROM products; -- 只返回不同的值，DISTINCT不能部分使用，其应用于所有列 SELECT prod_name FROM products LIMIT 5; -- 返回不多于5行 SELECT prod_name FROM products LIMIT 5,5; -- 返回从行5开始的5行，检索出的第一行为行0 SELECT prod_name FROM products LIMIT 4 OFFSET 3; -- 从行3开始取4行 SELECT products.prod_name FROM products; -- 使用完全限定的表名 三、排序检索数据 链接到标题 SELECT prod_name FROM products ORDER BY prod_name; -- 对prod_name以字母顺序排序 -- 多个行具有相同prod_price时，才对产品按prod_name进行排序，如果prod_price所有值唯一，则不会按prod_name排序。 SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price,prod_name; -- 首先对价格排序，在按名称排序 -- 默认进行升序排序，也可以指定ASC进行升序排序，但没必要 SElECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC; -- 对价格降序排序 -- 如果要对每个列进行降序排序，要对每个列指定DESC SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC, prod_name; -- 先对价格降序排序，在对名称排序 -- ORDER BY必须在FROM子句之后，LIMIT必须在ORDER BY子句之后 SELECT prod_price FROM products ORDER BY prod_price DESC LIMIT 1; -- 找出最贵的价格 四、过滤数据 链接到标题 ORDER BY 子句位于 WHERE 之后">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-01-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-01-02T00:00:00+00:00">
    <meta property="article:tag" content="Mysql">






<link rel="canonical" href="//localhost:1313/posts/c5gpdfxoio6edjxctrhchq49n6f/">








<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>



  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">








  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  







 
<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
 









<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>

<script src="//yihui.org/js/math-code.js" defer></script>
<script defer
  src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script> 

</head>






<body class="preload-transitions colorscheme-auto">
  



<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    
    <a class="navigation-title" href="//localhost:1313/">
      inaho
    </a>
    
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">文章</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/tags/">标签</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/categories/">分类</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">关于</a>
            </li>
          
        
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
<aside class="table-of-contents">
  <div class="toc-container">
    <h2>目录</h2>
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#mysql-入门">MySQL 入门</a></li>
    <li><a href="#mysql-入门知识">MYSQL 入门知识</a>
      <ul>
        <li><a href="#一mysql-基础命令">一、MySQL 基础命令</a></li>
        <li><a href="#二检索数据">二、检索数据</a></li>
        <li><a href="#三排序检索数据">三、排序检索数据</a></li>
        <li><a href="#四过滤数据">四、过滤数据</a></li>
        <li><a href="#五数据过滤">五、数据过滤</a></li>
        <li><a href="#六使用通配符进行过滤">六、使用通配符进行过滤</a></li>
        <li><a href="#七使用正则表达式搜索">七、使用正则表达式搜索</a>
          <ul>
            <li><a href="#匹配字符类">匹配字符类</a></li>
            <li><a href="#匹配多个实例">匹配多个实例</a></li>
          </ul>
        </li>
        <li><a href="#八创建计算字段">八、创建计算字段</a></li>
        <li><a href="#九使用数据处理函数">九、使用数据处理函数</a>
          <ul>
            <li><a href="#数据处理函数">数据处理函数</a></li>
            <li><a href="#文本处理函数">文本处理函数</a></li>
            <li><a href="#日期时间处理函数">日期时间处理函数</a></li>
          </ul>
        </li>
        <li><a href="#十汇总数据">十、汇总数据</a></li>
        <li><a href="#十一分组数据">十一、分组数据</a>
          <ul>
            <li><a href="#having-和-where-的区别">HAVING 和 WHERE 的区别</a></li>
          </ul>
        </li>
        <li><a href="#十二子查询">十二、子查询</a></li>
        <li><a href="#十三联结表内部联结">十三、联结表,内部联结</a></li>
        <li><a href="#十四创建高级联结">十四、创建高级联结</a>
          <ul>
            <li><a href="#自联结">自联结</a></li>
            <li><a href="#外部联结">外部联结</a></li>
            <li><a href="#带聚集函数的联结">带聚集函数的联结</a></li>
          </ul>
        </li>
        <li><a href="#十五组合查询">十五、组合查询</a></li>
        <li><a href="#十六全文本搜索">十六、全文本搜索</a>
          <ul>
            <li><a href="#全文本搜索">全文本搜索</a></li>
            <li><a href="#布尔文本搜索">布尔文本搜索</a></li>
          </ul>
        </li>
        <li><a href="#十七插入数据">十七、插入数据</a>
          <ul>
            <li><a href="#插入多条数据">插入多条数据</a></li>
            <li><a href="#创建-custnew-表">创建 custnew 表</a></li>
          </ul>
        </li>
        <li><a href="#十八更新和删除数据">十八、更新和删除数据</a>
          <ul>
            <li><a href="#更新数据">更新数据</a></li>
            <li><a href="#删除数据">删除数据</a></li>
          </ul>
        </li>
        <li><a href="#十九创建表和操纵表">十九、创建表和操纵表</a>
          <ul>
            <li><a href="#创建表">创建表</a></li>
            <li><a href="#引擎介绍">引擎介绍</a></li>
            <li><a href="#更新表">更新表</a></li>
            <li><a href="#删除表">删除表</a></li>
            <li><a href="#重命名表">重命名表</a></li>
          </ul>
        </li>
        <li><a href="#二十视图">二十、视图</a>
          <ul>
            <li><a href="#视图的规则">视图的规则</a></li>
            <li><a href="#使用视图简化复杂联结">使用视图简化复杂联结</a></li>
            <li><a href="#用视图格式化检索的数据">用视图格式化检索的数据</a></li>
            <li><a href="#用视图过滤不要的数据">用视图过滤不要的数据</a></li>
            <li><a href="#使用视图与计算字段">使用视图与计算字段</a></li>
            <li><a href="#更新视图">更新视图</a></li>
          </ul>
        </li>
        <li><a href="#二十一存储过程">二十一、存储过程</a></li>
        <li><a href="#二十二游标">二十二、游标</a>
          <ul>
            <li><a href="#使用游标涉及的步骤">使用游标涉及的步骤</a></li>
          </ul>
        </li>
        <li><a href="#二十三触发器">二十三、触发器</a>
          <ul>
            <li><a href="#insert-触发器">INSERT 触发器</a></li>
            <li><a href="#delete-触发器">DELETE 触发器</a></li>
            <li><a href="#update-触发器">UPDATE 触发器</a></li>
          </ul>
        </li>
        <li><a href="#二十四事务">二十四、事务</a>
          <ul>
            <li><a href="#概念解释">概念解释</a></li>
          </ul>
        </li>
        <li><a href="#二十五全球化和本地化">二十五、全球化和本地化</a>
          <ul>
            <li><a href="#概念解释-1">概念解释</a></li>
          </ul>
        </li>
        <li><a href="#二十六安全管理">二十六、安全管理</a></li>
        <li><a href="#二十七数据库维护">二十七、数据库维护</a></li>
        <li><a href="#三十改善性能">三十、改善性能</a></li>
      </ul>
    </li>
  </ul>
</nav>
    
  </div>
</aside>
<section class="container post">
  <article>
    <header>
      <div class="post-title">
        <h1 class="title">
          <a class="title-link" href="//localhost:1313/posts/c5gpdfxoio6edjxctrhchq49n6f/">
            MySQL 入门
          </a>
        </h1>
      </div>
      <div class="post-meta">
        <div class="date">
          <span class="posted-on">
            <i class="fa-solid fa-calendar" aria-hidden="true"></i>
            <time datetime=" 2021-01-02T00:00:00Z">
              2021-01-02
            </time>
          </span>
          <span class="reading-time">
            <i class="fa-solid fa-clock" aria-hidden="true"></i>
            阅读时间：16 分钟
          </span>
          <span class="post-word-count">
            <i class="fa fa-pie-chart" aria-hidden="true" style="margin-left: 10px;"></i>
            120783 字
          </span>
        </div>
        

<div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
  <a href="/authors/lzy/">Lzy</a></div>
        

<div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
  <a href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/">技术文档</a></div>
        

<div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
  <span class="tag">
    <a href="/tags/mysql/">Mysql</a>
  </span></div>
      </div>
    </header>

    <div class="post-content">
      
      <h1 id="mysql-入门">
  MySQL 入门
  <a class="heading-link" href="#mysql-%e5%85%a5%e9%97%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h1>
<h1 id="mysql-入门知识">
  MYSQL 入门知识
  <a class="heading-link" href="#mysql-%e5%85%a5%e9%97%a8%e7%9f%a5%e8%af%86">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h1>
<p>此文是阅读 MYSQL 必知必会后整理的所有样例代码，仅供自用。</p>
<h2 id="一mysql-基础命令">
  一、MySQL 基础命令
  <a class="heading-link" href="#%e4%b8%80mysql-%e5%9f%ba%e7%a1%80%e5%91%bd%e4%bb%a4">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">use database<span class="p">;</span>               -- 打开数据库
</span></span><span class="line"><span class="cl">show databases<span class="p">;</span>           -- 列出所有数据库
</span></span><span class="line"><span class="cl">show tables<span class="p">;</span>                -- 列出数据库所有表
</span></span><span class="line"><span class="cl">show columns from orders<span class="p">;</span> -- 列出表内所有的列
</span></span><span class="line"><span class="cl">describe orders<span class="p">;</span>           -- 列出表内所有的列
</span></span><span class="line"><span class="cl">show status<span class="p">;</span>               -- 显示广泛的服务器状态信息
</span></span></code></pre></div><hr>
<h2 id="二检索数据">
  二、检索数据
  <a class="heading-link" href="#%e4%ba%8c%e6%a3%80%e7%b4%a2%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">USE sqltest<span class="p">;</span>                                        -- 使用数据库
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_name,prod_price FROM products<span class="p">;</span>    -- 返回多列
</span></span><span class="line"><span class="cl">SELECT * FROM products<span class="p">;</span>                                -- 返回所有列
</span></span><span class="line"><span class="cl">SELECT DISTINCT vend_id FROM products<span class="p">;</span>                -- 只返回不同的值，DISTINCT不能部分使用，其应用于所有列
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products LIMIT 5<span class="p">;</span>                -- 返回不多于5行
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products LIMIT 5,5<span class="p">;</span>            -- 返回从行5开始的5行，检索出的第一行为行0
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products LIMIT <span class="m">4</span> OFFSET 3<span class="p">;</span>    -- 从行3开始取4行
</span></span><span class="line"><span class="cl">SELECT products.prod_name FROM products<span class="p">;</span>            -- 使用完全限定的表名
</span></span></code></pre></div><hr>
<h2 id="三排序检索数据">
  三、排序检索数据
  <a class="heading-link" href="#%e4%b8%89%e6%8e%92%e5%ba%8f%e6%a3%80%e7%b4%a2%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT prod_name FROM products ORDER BY prod_name<span class="p">;</span>    -- 对prod_name以字母顺序排序
</span></span><span class="line"><span class="cl">-- 多个行具有相同prod_price时，才对产品按prod_name进行排序，如果prod_price所有值唯一，则不会按prod_name排序。
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price,prod_name<span class="p">;</span>    -- 首先对价格排序，在按名称排序
</span></span><span class="line"><span class="cl">-- 默认进行升序排序，也可以指定ASC进行升序排序，但没必要
</span></span><span class="line"><span class="cl">SElECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC<span class="p">;</span>        -- 对价格降序排序
</span></span><span class="line"><span class="cl">-- 如果要对每个列进行降序排序，要对每个列指定DESC
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_price,prod_name FROM products ORDER BY prod_price DESC, prod_name<span class="p">;</span>    -- 先对价格降序排序，在对名称排序
</span></span><span class="line"><span class="cl">-- ORDER BY必须在FROM子句之后，LIMIT必须在ORDER BY子句之后
</span></span><span class="line"><span class="cl">SELECT prod_price FROM products ORDER BY prod_price DESC LIMIT 1<span class="p">;</span>        -- 找出最贵的价格
</span></span></code></pre></div><hr>
<h2 id="四过滤数据">
  四、过滤数据
  <a class="heading-link" href="#%e5%9b%9b%e8%bf%87%e6%bb%a4%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>ORDER BY 子句位于 WHERE 之后</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE <span class="nv">prod_price</span> <span class="o">=</span> 2.50<span class="p">;</span>    
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE <span class="nv">prod_name</span> <span class="o">=</span> <span class="s1">&#39;fuses&#39;</span><span class="p">;</span>      -- 执行匹配时默认不区分大小写
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE prod_price &lt; 10<span class="p">;</span>        -- 列出价格小于10美元的所有产品
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE prod_price &lt;<span class="o">=</span> 10<span class="p">;</span>        -- 列出价格小于等于10美元的所有产品
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_name FROM products WHERE vend_id &lt;&gt; 1003<span class="p">;</span>            -- 列出不是由供应商1003制造的所有产品
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_name FROM products WHERE vend_id !<span class="o">=</span> 1003<span class="p">;</span>            -- 与上式相同
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE prod_price BETWEEN <span class="m">5</span> AND 10<span class="p">;</span>    -- 检索价格在5-10美元之间的所有产品
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_price IS NULL<span class="p">;</span>                -- 返回没有价格的产品
</span></span><span class="line"><span class="cl">SELECT cust_id FROM customers WHERE cust_email IS NULL<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="五数据过滤">
  五、数据过滤
  <a class="heading-link" href="#%e4%ba%94%e6%95%b0%e6%8d%ae%e8%bf%87%e6%bb%a4">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT prod_id,prod_price,prod_name FROM products WHERE <span class="nv">vend_id</span> <span class="o">=</span> <span class="m">1003</span> AND prod_price &lt;<span class="o">=</span> 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE <span class="nv">vend_id</span> <span class="o">=</span> <span class="m">1002</span> OR <span class="nv">vend_id</span> <span class="o">=</span> 1003<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- SQL处理OR操作符前，优先处理AND操作符，应该使用圆括号分组处理
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE <span class="o">(</span><span class="nv">vend_id</span> <span class="o">=</span> <span class="m">1002</span> OR <span class="nv">vend_id</span> <span class="o">=</span> 1003<span class="o">)</span> AND prod_price &gt;<span class="o">=</span> 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- IN操作符指定条件范围，检索1002和1003制造的所有产品
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE vend_id IN <span class="o">(</span>1002,1003<span class="o">)</span> ORDER BY prod_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- IN操作符完成与OR相同的功能,IN操作符一般比OR执行更快
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE <span class="nv">vend_id</span> <span class="o">=</span> <span class="m">1002</span> OR <span class="nv">vend_id</span> <span class="o">=</span> <span class="m">1003</span> ORDER BY prod_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- MYSQL支持使用NOT对IN、BETWEEN和EXISTS子句取反
</span></span><span class="line"><span class="cl">SELECT prod_name,prod_price FROM products WHERE vend_id NOT IN <span class="o">(</span>1002,1003<span class="o">)</span> ORDER BY prod_name<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="六使用通配符进行过滤">
  六、使用通配符进行过滤
  <a class="heading-link" href="#%e5%85%ad%e4%bd%bf%e7%94%a8%e9%80%9a%e9%85%8d%e7%ac%a6%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>% 表示任何字符出现任意次数，根据 MySQL 的配置方式，搜索可以是区分大小写的！</p>
<p>% 无法匹配 NULL</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT prod_id,prod_name FROM products WHERE prod_name LIKE <span class="s1">&#39;jet%&#39;</span><span class="p">;</span>            -- 找出以jet开头的产品
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_name FROM products WHERE prod_name LIKE <span class="s1">&#39;%anvil%&#39;</span><span class="p">;</span>        -- 匹配包含文本anvil的值
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name LIKE <span class="s1">&#39;s%e&#39;</span><span class="p">;</span>                    -- 找出以s开头e结尾的产品
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_name FROM products WHERE prod_name LIKE <span class="s1">&#39;_ ton anvil&#39;</span><span class="p">;</span>    -- 下划线只匹配单个字符
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_name FROM products WHERE prod_name LIKE <span class="s1">&#39;% ton anvil&#39;</span><span class="p">;</span>    -- %匹配所有字符
</span></span></code></pre></div><hr>
<h2 id="七使用正则表达式搜索">
  七、使用正则表达式搜索
  <a class="heading-link" href="#%e4%b8%83%e4%bd%bf%e7%94%a8%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f%e6%90%9c%e7%b4%a2">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;1000&#39;</span> ORDER BY prod_name<span class="p">;</span>        -- 使用正则表达式
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;.000&#39;</span> ORDER BY prod_name<span class="p">;</span>        -- .在正则表达式能匹配任意内容
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP BINARY <span class="s1">&#39;JetPack .000&#39;</span><span class="p">;</span>            -- 默认不区分大小写，加BINARY可以区分大小写
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;1000|2000&#39;</span> ORDER BY prod_name<span class="p">;</span>    -- <span class="p">|</span> 是正则表达式的OR操作
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;[123] Ton&#39;</span> ORDER BY prod_name<span class="p">;</span>    -- <span class="o">[]</span>匹配特定字符，匹配1或2或3
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;[^123] Ton&#39;</span> ORDER BY prod_name<span class="p">;</span>    -- 匹配123以外的东西
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;1|2|3 Ton&#39;</span> ORDER BY prod_name<span class="p">;</span>    -- <span class="p">|</span> 应用于整个串
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;[1-5] Ton&#39;</span> ORDER BY prod_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT vend_name FROM vendors WHERE vend_name REGEXP <span class="s1">&#39;\\.&#39;</span> ORDER BY vend_name<span class="p">;</span>            -- <span class="se">\\</span>代表转义
</span></span></code></pre></div><hr>
<h3 id="匹配字符类">
  匹配字符类
  <a class="heading-link" href="#%e5%8c%b9%e9%85%8d%e5%ad%97%e7%ac%a6%e7%b1%bb">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT vend_name FROM vendors WHERE vend_name REGEXP <span class="s1">&#39;[:alnum:]&#39;</span> ORDER BY vend_name<span class="p">;</span>
</span></span></code></pre></div><hr>
<h3 id="匹配多个实例">
  匹配多个实例
  <a class="heading-link" href="#%e5%8c%b9%e9%85%8d%e5%a4%9a%e4%b8%aa%e5%ae%9e%e4%be%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;\\([0-9] sticks?\\)&#39;</span> ORDER BY prod_name<span class="p">;</span>    -- s后的？使s可选
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;[[:digit:]]{4}&#39;</span> ORDER BY prod_name<span class="p">;</span>    -- 匹配连在一起的任意4个数字
</span></span><span class="line"><span class="cl">-- ^匹配串的开始，只在.或任意数组为开头时才会匹配
</span></span><span class="line"><span class="cl">SELECT prod_name FROM products WHERE prod_name REGEXP <span class="s1">&#39;^[0-9\\.]&#39;</span> ORDER BY prod_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT <span class="s1">&#39;hello&#39;</span> REGEXP <span class="s1">&#39;[0-9]&#39;</span><span class="p">;</span>    -- 测试,不使用表
</span></span></code></pre></div><hr>
<h2 id="八创建计算字段">
  八、创建计算字段
  <a class="heading-link" href="#%e5%85%ab%e5%88%9b%e5%bb%ba%e8%ae%a1%e7%ae%97%e5%ad%97%e6%ae%b5">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT Concat<span class="o">(</span>vend_name,<span class="s1">&#39; (&#39;</span>,vend_country,<span class="s1">&#39;)&#39;</span><span class="o">)</span> FROM vendors ORDER BY vend_name<span class="p">;</span>    -- 拼接名称与国家
</span></span><span class="line"><span class="cl">SELECT Concat<span class="o">(</span>RTrim<span class="o">(</span>vend_name<span class="o">)</span>,<span class="s1">&#39;(&#39;</span>,RTrim<span class="o">(</span>vend_country<span class="o">)</span>,<span class="s1">&#39;)&#39;</span><span class="o">)</span> FROM vendors ORDER BY vend_name<span class="p">;</span>    -- RTrim删除值右边所有空格,还有LTrim和Trim函数
</span></span><span class="line"><span class="cl">-- 使用AS赋予列别名
</span></span><span class="line"><span class="cl">SELECT Concat<span class="o">(</span>RTrim<span class="o">(</span>vend_name<span class="o">)</span>,<span class="s1">&#39;(&#39;</span>,RTrim<span class="o">(</span>vend_country<span class="o">)</span>,<span class="s1">&#39;)&#39;</span><span class="o">)</span> AS vend_title FROM vendors ORDER BY vend_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT prod_id,quantity,item_price FROM orderitems WHERE <span class="nv">order_num</span> <span class="o">=</span> 20005<span class="p">;</span>    -- 检索订单号20005中所有物品
</span></span><span class="line"><span class="cl">-- 算术运算<span class="o">(</span>+,-,*,/<span class="o">)</span>
</span></span><span class="line"><span class="cl">SELECT prod_id,quantity,item_price,quantity*item_price AS expanded_price FROM orderitems WHERE <span class="nv">order_num</span> <span class="o">=</span> 20005<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- 测试计算
</span></span><span class="line"><span class="cl">SELECT 3*2<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT now<span class="o">()</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="九使用数据处理函数">
  九、使用数据处理函数
  <a class="heading-link" href="#%e4%b9%9d%e4%bd%bf%e7%94%a8%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<h3 id="数据处理函数">
  数据处理函数
  <a class="heading-link" href="#%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: center">函数名</th>
          <th style="text-align: left">功能描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><code>Abs()</code></td>
          <td style="text-align: left">返回一个数的绝对值</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Mod()</code></td>
          <td style="text-align: left">返回除操作的余数</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Sin()</code></td>
          <td style="text-align: left">返回角度的正弦</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Cos()</code></td>
          <td style="text-align: left">返回一个角度的余弦</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Pi()</code></td>
          <td style="text-align: left">返回圆周率</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Sqrt()</code></td>
          <td style="text-align: left">返回一个数的平方根</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Exp()</code></td>
          <td style="text-align: left">返回一个数的指数值</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Rand()</code></td>
          <td style="text-align: left">返回一个随机数</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Tan()</code></td>
          <td style="text-align: left">返回一个角度的正切</td>
      </tr>
  </tbody>
</table>
<h3 id="文本处理函数">
  文本处理函数
  <a class="heading-link" href="#%e6%96%87%e6%9c%ac%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: center">函数名</th>
          <th style="text-align: left">功能描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><code>Left()</code></td>
          <td style="text-align: left">返回串左边的字符</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Lower()/Upper()</code></td>
          <td style="text-align: left">将串转换为小/大写</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Right()</code></td>
          <td style="text-align: left">返回串右边字符</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Length()</code></td>
          <td style="text-align: left">返回串的长度</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>LTrim()</code></td>
          <td style="text-align: left">去掉左边空格</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Soundex()</code></td>
          <td style="text-align: left">返回串的类似发音的其他串</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>locate()</code></td>
          <td style="text-align: left">找出串的一个字串</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>RTrim()</code></td>
          <td style="text-align: left">去掉右边空格</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>SubString()</code></td>
          <td style="text-align: left">返回子串的字符</td>
      </tr>
  </tbody>
</table>
<h3 id="日期时间处理函数">
  日期时间处理函数
  <a class="heading-link" href="#%e6%97%a5%e6%9c%9f%e6%97%b6%e9%97%b4%e5%a4%84%e7%90%86%e5%87%bd%e6%95%b0">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: center">函数名</th>
          <th style="text-align: left">功能描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><code>AddDate()</code></td>
          <td style="text-align: left">增加一个日期(天、周等)</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>CurTime()</code></td>
          <td style="text-align: left">返回当前时间</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Date_Add()</code></td>
          <td style="text-align: left">高度灵活的日期运算函数</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>DayOfWeek()</code></td>
          <td style="text-align: left">返回星期几</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Month()</code></td>
          <td style="text-align: left">返回日期的月份部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Time()</code></td>
          <td style="text-align: left">返回日期时间的时间部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>AddTime()</code></td>
          <td style="text-align: left">增加一个时间</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Date()</code></td>
          <td style="text-align: left">返回日期时间的日期部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Date_Format()</code></td>
          <td style="text-align: left">返回格式化日期或时间串</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Hour()</code></td>
          <td style="text-align: left">返回时间的小时部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Now()</code></td>
          <td style="text-align: left">返回当前日期和时间</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Year()</code></td>
          <td style="text-align: left">返回日期的年份部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>CurDate()</code></td>
          <td style="text-align: left">返回当前日期</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>DateDiff()</code></td>
          <td style="text-align: left">计算两个日期之差</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Day()</code></td>
          <td style="text-align: left">返回日期的天数部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Minute()</code></td>
          <td style="text-align: left">返回时间的分钟部分</td>
      </tr>
      <tr>
          <td style="text-align: center"><code>Second()</code></td>
          <td style="text-align: left">返回时间的秒部分</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT vend_name, Upper<span class="o">(</span>vend_name<span class="o">)</span> AS vend_name_upcase FROM vendors ORDER BY vend_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT cust_name ,cust_contact FROM customers WHERE <span class="nv">cust_contact</span> <span class="o">=</span> <span class="s1">&#39;Y .Lie&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT cust_name,cust_contact FROM customers WHERE Soundex<span class="o">(</span>cust_contact<span class="o">)</span> <span class="o">=</span> Soundex<span class="o">(</span><span class="s1">&#39;Y Lie&#39;</span><span class="o">)</span><span class="p">;</span>    -- 对串进行发音比较
</span></span><span class="line"><span class="cl">SELECT cust_id,order_num FROM orders WHERE <span class="nv">order_date</span> <span class="o">=</span> <span class="s1">&#39;2005-09-01&#39;</span><span class="p">;</span> -- 日期必须为yyyy-mm-dd格式 
</span></span><span class="line"><span class="cl">SELECT cust_id,order_num FROM orders WHERE Date<span class="o">(</span>order_date<span class="o">)</span> <span class="o">=</span> <span class="s1">&#39;2005-09-01&#39;</span><span class="p">;</span>    -- 使用Date函数仅提取日期部分进行比较 
</span></span><span class="line"><span class="cl">-- 列出九月下所有的订单
</span></span><span class="line"><span class="cl">SELECT cust_id,order_num FROM orders WHERE Date<span class="o">(</span>order_date<span class="o">)</span> BETWEEN <span class="s1">&#39;2005-09-01&#39;</span> AND <span class="s1">&#39;2005-09-30&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT cust_id,order_num FROM orders WHERE Year<span class="o">(</span>order_date<span class="o">)</span> <span class="o">=</span> <span class="m">2005</span> AND Month<span class="o">(</span>order_date<span class="o">)</span> <span class="o">=</span> 9<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十汇总数据">
  十、汇总数据
  <a class="heading-link" href="#%e5%8d%81%e6%b1%87%e6%80%bb%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT AVG<span class="o">(</span>prod_price<span class="o">)</span> AS avg_price FROM products<span class="p">;</span>        -- 使用聚集函数，返回平均值
</span></span><span class="line"><span class="cl">SELECT AVG<span class="o">(</span>prod_price<span class="o">)</span> AS avg_price FROM products WHERE <span class="nv">vend_id</span> <span class="o">=</span> 1003<span class="p">;</span>    -- AVG只用于单个列，忽略NULL的行
</span></span><span class="line"><span class="cl">SELECT COUNT<span class="o">(</span>*<span class="o">)</span> AS num_cust FROM customers<span class="p">;</span>        -- 计算行数
</span></span><span class="line"><span class="cl">SELECT COUNT<span class="o">(</span>cust_email<span class="o">)</span> AS num_cust FROM customers<span class="p">;</span>    -- 只对具有电子邮件地址的客户计数
</span></span><span class="line"><span class="cl">SELECT MAX<span class="o">(</span>prod_price<span class="o">)</span> AS max_price FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT MIN<span class="o">(</span>prod_price<span class="o">)</span> AS min_price FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT SUM<span class="o">(</span>quantity<span class="o">)</span> AS items_ordered FROM orderitems WHERE <span class="nv">order_num</span> <span class="o">=</span> 20005<span class="p">;</span>    -- 订购物品的总数
</span></span><span class="line"><span class="cl">SELECT SUM<span class="o">(</span>item_price * quantity<span class="o">)</span> AS total_price FROM orderitems WHERE <span class="nv">order_num</span> <span class="o">=</span> 20005<span class="p">;</span>    -- 总的订单金额
</span></span><span class="line"><span class="cl">SELECT AVG<span class="o">(</span>DISTINCT prod_price<span class="o">)</span> AS avg_price FROM products WHERE <span class="nv">vend_id</span> <span class="o">=</span> 1003<span class="p">;</span>    -- 使用DISTINCT参数，只考虑各个不同的价格
</span></span><span class="line"><span class="cl">SELECT COUNT<span class="o">(</span>*<span class="o">)</span> AS num_items, MIN<span class="o">(</span>prod_price<span class="o">)</span> AS price_min,        -- 组合聚集函数
</span></span><span class="line"><span class="cl">        MAX<span class="o">(</span>prod_price<span class="o">)</span> AS price_max,
</span></span><span class="line"><span class="cl">        AVG<span class="o">(</span>prod_price<span class="o">)</span> AS price_avg FROM products<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十一分组数据">
  十一、分组数据
  <a class="heading-link" href="#%e5%8d%81%e4%b8%80%e5%88%86%e7%bb%84%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<h3 id="having-和-where-的区别">
  HAVING 和 WHERE 的区别
  <a class="heading-link" href="#having-%e5%92%8c-where-%e7%9a%84%e5%8c%ba%e5%88%ab">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>HAVING 过滤分组，而 WHERE 过滤行</li>
<li>WHERE 在数据分组前进行过滤，HAVING 在数据分组后进行过滤。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT COUNT<span class="o">(</span>*<span class="o">)</span> AS num_prods FROM products WHERE <span class="nv">vend_id</span> <span class="o">=</span> 1003<span class="p">;</span>        -- 返回1003提供的产品数目
</span></span><span class="line"><span class="cl">SELECT vend_id,COUNT<span class="o">(</span>*<span class="o">)</span> AS num_prods FROM products GROUP BY vend_id<span class="p">;</span>    -- 对vend_id排序并分组数据，每个vend_id只计算num_prods一次。
</span></span><span class="line"><span class="cl">SELECT vend_id, COUNT<span class="o">(</span>*<span class="o">)</span> AS num_prods FROM products GROUP BY vend_id WITH ROLLUP<span class="p">;</span>         -- 每个分组及其汇总级别的值
</span></span><span class="line"><span class="cl">SELECT cust_id,COUNT<span class="o">(</span>*<span class="o">)</span> AS orders FROM orders GROUP BY cust_id HAVING COUNT<span class="o">(</span>*<span class="o">)</span> &gt;<span class="o">=</span> 2<span class="p">;</span>    -- 过滤两个以上订单的分组
</span></span><span class="line"><span class="cl">SELECT vend_id,COUNT<span class="o">(</span>*<span class="o">)</span> AS num_prods FROM products WHERE prod_price &gt;<span class="o">=</span><span class="m">10</span> GROUP BY vend_id HAVING COUNT<span class="o">(</span>*<span class="o">)</span> &gt;<span class="o">=</span> 2<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT order_num,SUM<span class="o">(</span>quantity*item_price<span class="o">)</span> AS ordertotal FROM orderitems GROUP BY order_num
</span></span><span class="line"><span class="cl">HAVING SUM<span class="o">(</span>quantity * item_price<span class="o">)</span> &gt;<span class="o">=</span> <span class="m">50</span> ORDER BY ordertotal<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十二子查询">
  十二、子查询
  <a class="heading-link" href="#%e5%8d%81%e4%ba%8c%e5%ad%90%e6%9f%a5%e8%af%a2">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT cust_id FROM orders WHERE order_num IN <span class="o">(</span>SELECT order_num FROM orderitems WHERE <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;TNT2&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT cust_name, cust_contact FROM customers WHERE cust_id IN <span class="o">(</span>SELECT cust_id FROM orders WHERE order_num IN
</span></span><span class="line"><span class="cl">    <span class="o">(</span>SELECT order_num FROM orderitems WHERE <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;TNT2&#39;</span><span class="o">))</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT cust_name,cust_state,<span class="o">(</span>SELECT COUNT<span class="o">(</span>*<span class="o">)</span> FROM orders WHERE orders.cust_id <span class="o">=</span> customers.cust_id<span class="o">)</span> AS orders
</span></span><span class="line"><span class="cl">FROM customers ORDER BY cust_name<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十三联结表内部联结">
  十三、联结表,内部联结
  <a class="heading-link" href="#%e5%8d%81%e4%b8%89%e8%81%94%e7%bb%93%e8%a1%a8%e5%86%85%e9%83%a8%e8%81%94%e7%bb%93">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT vend_name,prod_name,prod_price FROM vendors,products 
</span></span><span class="line"><span class="cl">WHERE vendors.vend_id <span class="o">=</span> products.vend_id ORDER BY vend_name,prod_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT vend_name,prod_name,prod_price FROM vendors,products ORDER BY vend_name,prod_name<span class="p">;</span>    -- 没有联结条件，返回笛卡尔积
</span></span><span class="line"><span class="cl">SELECT vend_name,prod_name,prod_price FROM vendors INNER JOIN products ON vendors.vend_id <span class="o">=</span> products.vend_id<span class="p">;</span>
</span></span><span class="line"><span class="cl">SElECT prod_name,vend_name,prod_price,quantity FROM orderitems,products,vendors
</span></span><span class="line"><span class="cl">WHERE products.vend_id <span class="o">=</span> vendors.vend_id AND orderitems.prod_id <span class="o">=</span> products.prod_id
</span></span><span class="line"><span class="cl">AND <span class="nv">order_num</span> <span class="o">=</span> 20005<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- 子查询并不总是执行复杂SELECT操作的有效方法
</span></span><span class="line"><span class="cl">SELECT cust_name,cust_contact FROM customers WHERE cust_id IN <span class="o">(</span>SELECT cust_id FROM orders WHERE order_num IN
</span></span><span class="line"><span class="cl"><span class="o">(</span>SELECT order_num FROM orderitems WHERE <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;TNT2&#39;</span><span class="o">))</span><span class="p">;</span>        -- 可以用下列方法等效
</span></span><span class="line"><span class="cl">SELECT cust_name,cust_contact FROM customers,orders,orderitems WHERE customers.cust_id <span class="o">=</span> orders.cust_id
</span></span><span class="line"><span class="cl">AND orderitems.order_num <span class="o">=</span> orders.order_num AND <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;TNT2&#39;</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十四创建高级联结">
  十四、创建高级联结
  <a class="heading-link" href="#%e5%8d%81%e5%9b%9b%e5%88%9b%e5%bb%ba%e9%ab%98%e7%ba%a7%e8%81%94%e7%bb%93">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT cust_name,cust_contact FROM customers AS c, orders AS o, orderitems AS oi    -- 使用表别名
</span></span><span class="line"><span class="cl">WHERE c.cust_id <span class="o">=</span> o.cust_id AND oi.order_num <span class="o">=</span> o.order_num AND <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;TNT2&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT prod_id,prod_name FROM products WHERE
</span></span><span class="line"><span class="cl"><span class="nv">vend_id</span> <span class="o">=</span> <span class="o">(</span>SELECT vend_id FROM products WHERE <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;DTNTR&#39;</span><span class="o">)</span><span class="p">;</span>    -- 子查询
</span></span></code></pre></div><hr>
<h3 id="自联结">
  自联结
  <a class="heading-link" href="#%e8%87%aa%e8%81%94%e7%bb%93">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-- 自然联结排除多次出现，使每个列只返回一次
</span></span><span class="line"><span class="cl">SELECT p1.prod_id,p1.prod_name FROM products AS p1,products AS p2 WHERE p1.vend_id <span class="o">=</span> p2.vend_id
</span></span><span class="line"><span class="cl">AND p2.prod_id <span class="o">=</span> <span class="s1">&#39;DTNTR&#39;</span><span class="p">;</span>    -- 自联结处理远比子查询快的多
</span></span><span class="line"><span class="cl">-- 通配符只对第一个表使用。
</span></span><span class="line"><span class="cl">SELECT c.*,o.order_num,o.order_date,oi.prod_id,oi.quantity,oi.item_price FROM
</span></span><span class="line"><span class="cl">customers AS c,orders AS o,orderitems AS oi WHERE
</span></span><span class="line"><span class="cl">c.cust_id <span class="o">=</span> o.cust_id AND oi.order_num <span class="o">=</span> o.order_num AND <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;FB&#39;</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<h3 id="外部联结">
  外部联结
  <a class="heading-link" href="#%e5%a4%96%e9%83%a8%e8%81%94%e7%bb%93">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>联结包含了那些在相关表中没有关联行的行，这种称为外部联结</li>
<li><strong>RIGHT</strong> 指出是 <strong>OUTER JOIN</strong> 右边的表，<strong>LEFT</strong> 指出是 <strong>OUTER JOIN</strong> 左边的表</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT customers.cust_id,orders.order_num FROM customers         -- 左边表选择所有行 
</span></span><span class="line"><span class="cl">LEFT OUTER JOIN orders ON customers.cust_id <span class="o">=</span> orders.cust_id<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT customers.cust_id,orders.order_num FROM customers        -- 右边表选择所有行
</span></span><span class="line"><span class="cl">RIGHT OUTER JOIN orders ON customers.cust_id <span class="o">=</span> orders.cust_id<span class="p">;</span>
</span></span></code></pre></div><hr>
<h3 id="带聚集函数的联结">
  带聚集函数的联结
  <a class="heading-link" href="#%e5%b8%a6%e8%81%9a%e9%9b%86%e5%87%bd%e6%95%b0%e7%9a%84%e8%81%94%e7%bb%93">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<p>检索所有客户及每个客户所下的订单数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT customers.cust_name,customers.cust_id,COUNT<span class="o">(</span>orders.order_num<span class="o">)</span> AS num_ord
</span></span><span class="line"><span class="cl">FROM customers INNER JOIN orders ON customers.cust_id <span class="o">=</span> orders.cust_id GROUP BY customers.cust_id<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT customers.cust_name,customers.cust_id,COUNT<span class="o">(</span>orders.order_num<span class="o">)</span> AS num_ord    -- 使用左外部联结包含所有客户
</span></span><span class="line"><span class="cl">FROM customers LEFT OUTER JOIN orders ON customers.cust_id <span class="o">=</span> orders.cust_id GROUP BY customers.cust_id<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十五组合查询">
  十五、组合查询
  <a class="heading-link" href="#%e5%8d%81%e4%ba%94%e7%bb%84%e5%90%88%e6%9f%a5%e8%af%a2">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT vend_id,prod_id,prod_price FROM products WHERE prod_price &lt;<span class="o">=</span> <span class="m">5</span>
</span></span><span class="line"><span class="cl">UNION        -- 两条SELECT语句之间使用UNION组合
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_id,prod_price FROM products WHERE vend_id IN<span class="o">(</span>1001,1002<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">-- 相同的使用where的查询,UNION更使用于从多个表检索数据的情形
</span></span><span class="line"><span class="cl">-- UNION从查询结果集自动去除了重复的行，这是默认行为，但也可以令其返回所有匹配的行，使用UNION ALL
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_id,prod_price FROM products WHERE prod_price &lt;<span class="o">=</span><span class="m">5</span>
</span></span><span class="line"><span class="cl">UNION ALL
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_id,prod_price FROM products WHERE vend_id IN <span class="o">(</span>1001,1002<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">-- 使用UNION查询时，只能使用一条ORDER BY子句
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_id,prod_price FROM products WHERE prod_price &lt;<span class="o">=</span><span class="m">5</span>
</span></span><span class="line"><span class="cl">UNION
</span></span><span class="line"><span class="cl">SELECT vend_id,prod_id,prod_price FROM products WHERE vend_id IN <span class="o">(</span>1001,1002<span class="o">)</span>
</span></span><span class="line"><span class="cl">ORDER BY vend_id,prod_price<span class="p">;</span>    -- 排序UNION返回的结果集
</span></span></code></pre></div><hr>
<h2 id="十六全文本搜索">
  十六、全文本搜索
  <a class="heading-link" href="#%e5%8d%81%e5%85%ad%e5%85%a8%e6%96%87%e6%9c%ac%e6%90%9c%e7%b4%a2">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>MySQL 常用的引擎为 MyISAM 和 InnoDB，前者支持全文本搜索，后者不支持.</p>
<p>一般在创建表时启用全文本搜索，接受 FULLTEXT 子句.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TABLE productnotes<span class="o">(</span>
</span></span><span class="line"><span class="cl">note_id        int            NOT NULL AUTO_INCREMENT,
</span></span><span class="line"><span class="cl">prod_id     char<span class="o">(</span>10<span class="o">)</span>     NOT NULL,
</span></span><span class="line"><span class="cl">note_date     datetime     NOT NULL,
</span></span><span class="line"><span class="cl">note_text    text        NULL,
</span></span><span class="line"><span class="cl">PRIMARY KEY<span class="o">(</span>note_id<span class="o">)</span>,
</span></span><span class="line"><span class="cl">FULLTEXT<span class="o">(</span>note_text<span class="o">)</span>        -- 为了进行全文本搜索，MySql根据这句的指示对它进行索引，这里索引单个列。
</span></span><span class="line"><span class="cl"><span class="o">)</span> <span class="nv">ENGINE</span> <span class="o">=</span> MyISAM<span class="p">;</span>        -- MySql会自动维护索引，不要在导入数据时启用FULLTEXT，应该在导入数据后修改表再启用
</span></span></code></pre></div><hr>
<h3 id="全文本搜索">
  全文本搜索
  <a class="heading-link" href="#%e5%85%a8%e6%96%87%e6%9c%ac%e6%90%9c%e7%b4%a2">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-- Match指定被搜索的列，Against指定要使用的搜索表达式
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;rabbit&#39;</span><span class="o">)</span><span class="p">;</span>    -- 传递给Match的值必须于FULLTEXT定义中的相同
</span></span><span class="line"><span class="cl">-- 也可以用like语句完成
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE note_text LIKE <span class="s1">&#39;%rabbit%&#39;</span><span class="p">;</span>        -- 没有行排序，全文本搜索有行排序
</span></span><span class="line"><span class="cl">-- 等级根据行中词的数目、唯一词的数目、整个索引中词的总数以及包含该词的行数计算出来。
</span></span><span class="line"><span class="cl">SELECT note_text,Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;rabbit&#39;</span><span class="o">)</span> AS ranks FROM productnotes<span class="p">;</span>     -- Match与Against返回等级
</span></span><span class="line"><span class="cl">-- 查询扩展
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;anvils&#39;</span><span class="o">)</span><span class="p">;</span>    -- 未使用查询扩展
</span></span><span class="line"><span class="cl">-- 使用查询扩展进行两次扫描，第一次扫描选择所有有用的词，第二次使用所有有用的词，返回可能相关的结果。
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;anvils&#39;</span> WITH QUERY EXPANSION<span class="o">)</span><span class="p">;</span>    -- 使用查询扩展
</span></span></code></pre></div><hr>
<h3 id="布尔文本搜索">
  布尔文本搜索
  <a class="heading-link" href="#%e5%b8%83%e5%b0%94%e6%96%87%e6%9c%ac%e6%90%9c%e7%b4%a2">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<p>索引全文本数据时，短词被忽略且从索引中排除，短词为具有 3 个或以下字符的词(这个数目可以改).</p>
<p>MySql 有一个非用词列表，列表的词也会被忽略.</p>
<p>如果一个词出现 50% 以上的行中，则将它作为一个非用词忽略，不用于 IN BOOLEAN MODE</p>
<p>如果表中行数少于 3 行，全文本搜索不返回结果（每个词或者不出现，或者出现在 50% 的行中）</p>
<p>忽略词中的单引号</p>
<p>不具有词分隔符的语言不能恰当返回全文本搜索结果</p>
<p>布尔方式中，不按等级值降序排序返回的行。</p>
<ul>
<li>
<ul>
<li>包含，词必须存在</li>
</ul>
</li>
<li>-排除，词必须不出现</li>
<li>
<blockquote>
<p>包含，而且增加等级值</p></blockquote>
</li>
<li>&lt; 包含，且减少等级值</li>
<li>()把词组成子表达式，允许这些子表达式作为一个组，被包含、排除、排列等</li>
<li>~取消一个词的排序值</li>
<li>*词尾的通配符</li>
<li>“”定义一个短语，与单个词的列表不同，它匹配整个短语以便包含或排除这个短语</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;heavy&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>-- 没有指定布尔操作符
</span></span><span class="line"><span class="cl">-- 匹配包含heavy但不包含任意以rope开始的词的行,-rope*指定排除任何以rope开始的词的行。
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;heavy -rope*&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;+rabbit +bait&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;rabbit bait&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>    -- 包含其中至少一个词
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;&#34;rabbit bait&#34;&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>    -- 匹配短语
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;&gt;rabbit &lt;carrot&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>    -- 增加前者等级，降低后者等级
</span></span><span class="line"><span class="cl">SELECT note_text FROM productnotes WHERE Match<span class="o">(</span>note_text<span class="o">)</span> Against<span class="o">(</span><span class="s1">&#39;+safe +(&lt;combination)&#39;</span> IN BOOLEAN MODE<span class="o">)</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="十七插入数据">
  十七、插入数据
  <a class="heading-link" href="#%e5%8d%81%e4%b8%83%e6%8f%92%e5%85%a5%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<ul>
<li>如果表的定义允许，可以省略某些列</li>
<li>可以通过在 INSERT 和 INTO 之间 LOW_PRIORITY 降低 INSERT 语句的优先级。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">INSERT INTO customers VALUES<span class="o">(</span> NULL,        -- 对每一列必须提供一个值，按次序填充。id为自动填充，但不想给出这个值也不想省略，可以给NULL。
</span></span><span class="line"><span class="cl"><span class="s1">&#39;Pep E. LaPew&#39;</span>,<span class="s1">&#39;100 Main Street&#39;</span>,<span class="s1">&#39;Los Angeles&#39;</span>,    -- 这种语法不安全
</span></span><span class="line"><span class="cl"><span class="s1">&#39;Ca&#39;</span>,90046,<span class="s1">&#39;USA&#39;</span>,NULL,NULL<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">INSERT INTO customers<span class="o">(</span>cust_name,cust_address,cust_city,cust_state,cust_zip,cust_country,cust_contact,cust_email<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span><span class="s1">&#39;Pep E. LaPew&#39;</span>,<span class="s1">&#39;100 Main Street&#39;</span>,<span class="s1">&#39;Los Angeles&#39;</span>,<span class="s1">&#39;CA&#39;</span>,<span class="s1">&#39;90046&#39;</span>,<span class="s1">&#39;USA&#39;</span>,NULL,NULL<span class="o">)</span><span class="p">;</span> -- 给出列名，与值一一对应 
</span></span><span class="line"><span class="cl">INSERT INTO customers<span class="o">(</span>cust_name,cust_contact,cust_email,cust_address,cust_city,cust_state,cust_zip,cust_country<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span><span class="s1">&#39;Pep E. LaPew&#39;</span>,NULL,NULL,<span class="s1">&#39;100 Main Street&#39;</span>,<span class="s1">&#39;Los Angeles&#39;</span>,<span class="s1">&#39;CA&#39;</span>,<span class="s1">&#39;90046&#39;</span>,<span class="s1">&#39;USA&#39;</span><span class="o">)</span><span class="p">;</span>    -- 与上面的语句顺序不同
</span></span></code></pre></div><h3 id="插入多条数据">
  插入多条数据
  <a class="heading-link" href="#%e6%8f%92%e5%85%a5%e5%a4%9a%e6%9d%a1%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">INSERT INTO customers<span class="o">(</span>cust_name,cust_address,cust_city,cust_state,cust_zip,cust_country<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUE<span class="o">(</span><span class="s1">&#39;Pep E. LaPew&#39;</span>,<span class="s1">&#39;100 Main Street&#39;</span>,<span class="s1">&#39;Los Angeles&#39;</span>,<span class="s1">&#39;CA&#39;</span>,<span class="s1">&#39;90046&#39;</span>,<span class="s1">&#39;USA&#39;</span><span class="o">)</span>,
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="s1">&#39;M. Martian&#39;</span>,<span class="s1">&#39;42 Galaxy Way&#39;</span>,<span class="s1">&#39;New York&#39;</span>,<span class="s1">&#39;NY&#39;</span>,<span class="s1">&#39;11213&#39;</span>,<span class="s1">&#39;USA&#39;</span><span class="o">)</span><span class="p">;</span>    -- 使用单条INSERT语句比多条快
</span></span></code></pre></div><h3 id="创建-custnew-表">
  创建 custnew 表
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba-custnew-%e8%a1%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TABLE custnew
</span></span><span class="line"><span class="cl"><span class="o">(</span>
</span></span><span class="line"><span class="cl">  cust_id      int       NOT NULL AUTO_INCREMENT,
</span></span><span class="line"><span class="cl">  cust_name    char<span class="o">(</span>50<span class="o">)</span>  NOT NULL ,
</span></span><span class="line"><span class="cl">  cust_address char<span class="o">(</span>50<span class="o">)</span>  NULL ,
</span></span><span class="line"><span class="cl">  cust_city    char<span class="o">(</span>50<span class="o">)</span>  NULL ,
</span></span><span class="line"><span class="cl">  cust_state   char<span class="o">(</span>5<span class="o">)</span>   NULL ,
</span></span><span class="line"><span class="cl">  cust_zip     char<span class="o">(</span>10<span class="o">)</span>  NULL ,
</span></span><span class="line"><span class="cl">  cust_country char<span class="o">(</span>50<span class="o">)</span>  NULL ,
</span></span><span class="line"><span class="cl">  cust_contact char<span class="o">(</span>50<span class="o">)</span>  NULL ,
</span></span><span class="line"><span class="cl">  cust_email   char<span class="o">(</span>255<span class="o">)</span> NULL ,
</span></span><span class="line"><span class="cl">  PRIMARY KEY <span class="o">(</span>cust_id<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span> <span class="nv">ENGINE</span><span class="o">=</span>InnoDB<span class="p">;</span>
</span></span><span class="line"><span class="cl">INSERT INTO custnew<span class="o">(</span>cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip, cust_country, cust_contact, cust_email<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span>NULL, <span class="s1">&#39;Coyote Inc.&#39;</span>, <span class="s1">&#39;200 Maple Lane&#39;</span>, <span class="s1">&#39;Detroit&#39;</span>, <span class="s1">&#39;MI&#39;</span>, <span class="s1">&#39;44444&#39;</span>, <span class="s1">&#39;USA&#39;</span>, <span class="s1">&#39;Y Lee&#39;</span>, <span class="s1">&#39;ylee@coyote.com&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">INSERT INTO custnew<span class="o">(</span>cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip, cust_country, cust_contact<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span>NULL, <span class="s1">&#39;Mouse House&#39;</span>, <span class="s1">&#39;333 Fromage Lane&#39;</span>, <span class="s1">&#39;Columbus&#39;</span>, <span class="s1">&#39;OH&#39;</span>, <span class="s1">&#39;43333&#39;</span>, <span class="s1">&#39;USA&#39;</span>, <span class="s1">&#39;Jerry Mouse&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">INSERT INTO custnew<span class="o">(</span>cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip, cust_country, cust_contact, cust_email<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span>NULL, <span class="s1">&#39;Wascals&#39;</span>, <span class="s1">&#39;1 Sunny Place&#39;</span>, <span class="s1">&#39;Muncie&#39;</span>, <span class="s1">&#39;IN&#39;</span>, <span class="s1">&#39;42222&#39;</span>, <span class="s1">&#39;USA&#39;</span>, <span class="s1">&#39;Jim Jones&#39;</span>, <span class="s1">&#39;rabbit@wascally.com&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">INSERT INTO custnew<span class="o">(</span>cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip, cust_country, cust_contact, cust_email<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span>NULL, <span class="s1">&#39;Yosemite Place&#39;</span>, <span class="s1">&#39;829 Riverside Drive&#39;</span>, <span class="s1">&#39;Phoenix&#39;</span>, <span class="s1">&#39;AZ&#39;</span>, <span class="s1">&#39;88888&#39;</span>, <span class="s1">&#39;USA&#39;</span>, <span class="s1">&#39;Y Sam&#39;</span>, <span class="s1">&#39;sam@yosemite.com&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">INSERT INTO custnew<span class="o">(</span>cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip, cust_country, cust_contact<span class="o">)</span>
</span></span><span class="line"><span class="cl">VALUES<span class="o">(</span>NULL, <span class="s1">&#39;E Fudd&#39;</span>, <span class="s1">&#39;4545 53rd Street&#39;</span>, <span class="s1">&#39;Chicago&#39;</span>, <span class="s1">&#39;IL&#39;</span>, <span class="s1">&#39;54545&#39;</span>, <span class="s1">&#39;USA&#39;</span>, <span class="s1">&#39;E Fudd&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span></code></pre></div><p>将 custnew 表中的数据导入 customers 表中,不一定要求列名匹配，SELECT 中第一列(不管其列名),填充 INSERT 指定的第一列，SELECT 还可以用 WHERE 过滤数据。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">INSERT INTO customers<span class="o">(</span>cust_id,cust_contact,cust_email,cust_name,cust_address,cust_city,cust_state,cust_zip,cust_country<span class="o">)</span>
</span></span><span class="line"><span class="cl">SELECT cust_id,cust_contact,cust_email,cust_name,cust_address,cust_city,cust_state,cust_zip,cust_country FROM custnew<span class="p">;</span>
</span></span></code></pre></div><h2 id="十八更新和删除数据">
  十八、更新和删除数据
  <a class="heading-link" href="#%e5%8d%81%e5%85%ab%e6%9b%b4%e6%96%b0%e5%92%8c%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<h3 id="更新数据">
  更新数据
  <a class="heading-link" href="#%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<p>UPDATE 语句中可以使用子查询.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">UPDATE customers SET <span class="nv">cust_email</span> <span class="o">=</span> <span class="s1">&#39;elmer@fudd.com&#39;</span> WHERE <span class="nv">cust_id</span> <span class="o">=</span> 10005<span class="p">;</span>    -- 如果没有WHERE语句，将会更新所有行
</span></span><span class="line"><span class="cl">UPDATE customers SET <span class="nv">cust_name</span> <span class="o">=</span> <span class="s1">&#39;The Fudds&#39;</span>,cust_email <span class="o">=</span> <span class="s1">&#39;elmer@fudd.com&#39;</span> WHERE <span class="nv">cust_id</span> <span class="o">=</span> 10005<span class="p">;</span>    -- 更新多个列
</span></span><span class="line"><span class="cl">-- 如果用UPDATE更新多行，并且在更新这些行中的一行或多行出现一个错误，整个UPDATE操作被去取消，并恢复原值
</span></span><span class="line"><span class="cl">-- 可以使用IGNORE使发生错误也继续更新 UPDATE IGNORE customers
</span></span><span class="line"><span class="cl">UPDATE customers SET <span class="nv">cust_email</span> <span class="o">=</span> NULL WHERE <span class="nv">cust_id</span> <span class="o">=</span> 10005<span class="p">;</span>     -- 删除某列的值，可以将其定为NULL<span class="o">(</span>表定义必须允许为NULL<span class="o">)</span>
</span></span></code></pre></div><h3 id="删除数据">
  删除数据
  <a class="heading-link" href="#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">DELETE FROM customers WHERE <span class="nv">cust_id</span> <span class="o">=</span> 10006<span class="p">;</span>    -- 删除一行
</span></span><span class="line"><span class="cl">TRUNCATE TABLE customers<span class="p">;</span>        -- 从表中删除所有行，实质是删除原来的表 并重新创建一个表，更快。
</span></span></code></pre></div><h2 id="十九创建表和操纵表">
  十九、创建表和操纵表
  <a class="heading-link" href="#%e5%8d%81%e4%b9%9d%e5%88%9b%e5%bb%ba%e8%a1%a8%e5%92%8c%e6%93%8d%e7%ba%b5%e8%a1%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<h3 id="创建表">
  创建表
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e8%a1%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>如果仅想在一个表不存在时创建它，应该在表名后给出 IF NOT EXISTS。</li>
<li>这样不检查已有表的模式是否与创建的表模式相匹配，只查看表名是否存在，仅在表名不存在时创建它。</li>
<li>每个表列或者是 NULL 列，或者是 NOT NULL 列</li>
<li>主键必须唯一，如果使用多个列，这些列的组合值必须唯一。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TABLE customers<span class="o">(</span>
</span></span><span class="line"><span class="cl">    cust_id            int            NOT NULL AUTO_INCREMENT,    -- 自动增量
</span></span><span class="line"><span class="cl">    cust_name        char<span class="o">(</span>50<span class="o">)</span>    NOT NULL,
</span></span><span class="line"><span class="cl">    cust_address     char<span class="o">(</span>50<span class="o">)</span>    NULL,
</span></span><span class="line"><span class="cl">    cust_city        char<span class="o">(</span>50<span class="o">)</span>    NULL,
</span></span><span class="line"><span class="cl">    cust_state        char<span class="o">(</span>5<span class="o">)</span>        NULL,
</span></span><span class="line"><span class="cl">    cust_zip        char<span class="o">(</span>10<span class="o">)</span>    NULL,
</span></span><span class="line"><span class="cl">    cust_country    char<span class="o">(</span>50<span class="o">)</span>    NULL,
</span></span><span class="line"><span class="cl">    cust_contact    char<span class="o">(</span>50<span class="o">)</span>    NULL,
</span></span><span class="line"><span class="cl">    cust_email        char<span class="o">(</span>255<span class="o">)</span>    NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY<span class="o">(</span>cust_id<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span><span class="nv">ENGINE</span> <span class="o">=</span> InnoDB<span class="p">;</span>
</span></span><span class="line"><span class="cl">CREATE TABLE orderitems<span class="o">(</span>
</span></span><span class="line"><span class="cl">    order_num    int                NOT NULL,
</span></span><span class="line"><span class="cl">    order_item    int                NOT NULL,
</span></span><span class="line"><span class="cl">    prod_id        char<span class="o">(</span>10<span class="o">)</span>        NOT NULL,
</span></span><span class="line"><span class="cl">    quantity    int                NOT NULL,
</span></span><span class="line"><span class="cl">    item_price    decimal<span class="o">(</span>8,2<span class="o">)</span>    NOT NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY<span class="o">(</span>order_num,order_item<span class="o">)</span>    -- 创建由多个列组成的主键
</span></span><span class="line"><span class="cl"><span class="o">)</span><span class="nv">ENGINE</span><span class="o">=</span>InnoDB<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT last_insert_id<span class="o">()</span><span class="p">;</span>     -- 返回最后一个AUTO_INCREMENT值
</span></span></code></pre></div><ul>
<li>MySql 不允许函数作为默认值</li>
<li>许多数据库开发人员使用默认值而不是 NULL 列，特别是对用于计算或数据分组的列</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TABLE orderitems<span class="o">(</span>
</span></span><span class="line"><span class="cl">    order_num    int                NOT NULL,
</span></span><span class="line"><span class="cl">    order_item    int                NOT NULL,
</span></span><span class="line"><span class="cl">    prod_id        char<span class="o">(</span>10<span class="o">)</span>        NOT NULL,
</span></span><span class="line"><span class="cl">    quantity    int                NOT NULL DEFAULT 1,  -- 指定默认值
</span></span><span class="line"><span class="cl">    item_price    decimal<span class="o">(</span>8,2<span class="o">)</span>    NOT NULL,
</span></span><span class="line"><span class="cl">    PRIMARY KEY<span class="o">(</span>order_num,order_item<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span><span class="nv">ENGINE</span> <span class="o">=</span> InnoDB<span class="p">;</span>
</span></span></code></pre></div><h3 id="引擎介绍">
  引擎介绍
  <a class="heading-link" href="#%e5%bc%95%e6%93%8e%e4%bb%8b%e7%bb%8d">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>InnoDB 是一个可靠的事务处理引擎，不支持全文本搜索</li>
<li>MEMORY 在功能等同于 MyISAM，但由于数据存储在内存中，速度很快，适合于临时表</li>
<li>MyISAM 是一个性能极高的引擎，支持全文本搜索 ，不支持事务处理</li>
<li>混用引擎类型有一个大缺陷，外键不能跨引擎，即使用一个引擎的表不能引用具有使用不同引擎的表的外键。</li>
</ul>
<h3 id="更新表">
  更新表
  <a class="heading-link" href="#%e6%9b%b4%e6%96%b0%e8%a1%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<p>理想状态下，当该表存了数据之后，就不应该被更新</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ALTER TABLE vendors ADD vend_phone CHAR<span class="o">(</span>20<span class="o">)</span><span class="p">;</span>    -- 给表添加一列
</span></span><span class="line"><span class="cl">ALTER TABLE vendors DROP COLUMN vend_phone<span class="p">;</span>        -- 删除刚刚添加的列
</span></span><span class="line"><span class="cl">-- ALTER常用于定义外键
</span></span><span class="line"><span class="cl">ALTER TABLE orderitems ADD CONSTRAINT fk_orderitems_orders
</span></span><span class="line"><span class="cl">FOREIGN KEY <span class="o">(</span>order_num<span class="o">)</span> REFERENCES orders <span class="o">(</span>order_num<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">ALTER TABLE orderitems ADD CONSTRAINT fk_orderitems_products 
</span></span><span class="line"><span class="cl">FOREIGN KEY <span class="o">(</span>prod_id<span class="o">)</span> REFERENCES orders <span class="o">(</span>prod_id<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">ALTER TABLE orders ADD CONSTRAINT fk_orderitems_customers 
</span></span><span class="line"><span class="cl">FOREIGN KEY <span class="o">(</span>cust_id<span class="o">)</span> REFERENCES customers <span class="o">(</span>cust_id<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">ALTER TABLE products ADD CONSTRAINT fk_products_vendors
</span></span><span class="line"><span class="cl">FOREIGN KEY <span class="o">(</span>vend_id<span class="o">)</span> REFERENCES vendors <span class="o">(</span>vend_id<span class="o">)</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="删除表">
  删除表
  <a class="heading-link" href="#%e5%88%a0%e9%99%a4%e8%a1%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">DROP TABLE customers2<span class="p">;</span>
</span></span></code></pre></div><h3 id="重命名表">
  重命名表
  <a class="heading-link" href="#%e9%87%8d%e5%91%bd%e5%90%8d%e8%a1%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">RENAME TABLE customer2 TO customers<span class="p">;</span>
</span></span><span class="line"><span class="cl">RENAME TABLE backup_customers TO customers,    -- 重命名多个表
</span></span><span class="line"><span class="cl">             backup_vendors TO vendors,
</span></span><span class="line"><span class="cl">             backup_products TO products<span class="p">;</span>
</span></span></code></pre></div><h2 id="二十视图">
  二十、视图
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e8%a7%86%e5%9b%be">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<ul>
<li>视图是虚拟的表，只包含使用时动态检索数据的查询。</li>
<li>视图可以重用 SQL 语句，简化复杂 SQL 操作，使用表的组成部分，保护数据，更改数据格式和表示。</li>
<li>每次使用视图，都必须处理查询执行时所需的任一个检索，如果创建了复杂的视图，性能下降的厉害</li>
</ul>
<h3 id="视图的规则">
  视图的规则
  <a class="heading-link" href="#%e8%a7%86%e5%9b%be%e7%9a%84%e8%a7%84%e5%88%99">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>视图必须唯一命名</li>
<li>创建视图必须有足够的访问权限</li>
<li>视图可以嵌套</li>
<li>ORDER BY 可以用在视图中，如果从该视图检索数据的 SELECT 语句中也有 ORDER BY，那么该视图中的 ORDER BY 将被覆盖。</li>
<li>视图不能索引，也不能有关联的触发器或默认值。</li>
<li>视图可以和表一起使用</li>
<li>更新视图可以先 DROP 再用 CREATE 也可以 CREATE OR REPLACE VIEW。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SHOW CREATE VIEW vendorlocations<span class="p">;</span>    -- 查看创建的视图
</span></span><span class="line"><span class="cl">DROP VIEW viewname<span class="p">;</span>        -- 删除视图
</span></span></code></pre></div><h3 id="使用视图简化复杂联结">
  使用视图简化复杂联结
  <a class="heading-link" href="#%e4%bd%bf%e7%94%a8%e8%a7%86%e5%9b%be%e7%ae%80%e5%8c%96%e5%a4%8d%e6%9d%82%e8%81%94%e7%bb%93">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE VIEW productcustomers AS SELECT cust_name,cust_contact,prod_id    -- 联结三个表，以返回已订购了任意产品的所有客户的列表。
</span></span><span class="line"><span class="cl">FROM customers,orders,orderitems WHERE customers.cust_id <span class="o">=</span> orders.cust_id
</span></span><span class="line"><span class="cl">AND orderitems.order_num <span class="o">=</span> orders.order_num<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM productcustomers<span class="p">;</span>        -- 列出订购了任意产品的客户
</span></span><span class="line"><span class="cl">SELECT cust_name,cust_contact FROM productcustomers WHERE <span class="nv">prod_id</span> <span class="o">=</span> <span class="s1">&#39;TNT2&#39;</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="用视图格式化检索的数据">
  用视图格式化检索的数据
  <a class="heading-link" href="#%e7%94%a8%e8%a7%86%e5%9b%be%e6%a0%bc%e5%bc%8f%e5%8c%96%e6%a3%80%e7%b4%a2%e7%9a%84%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE VIEW vendorlocations AS 
</span></span><span class="line"><span class="cl">SELECT Concat<span class="o">(</span>RTrim<span class="o">(</span>vend_name<span class="o">)</span>,<span class="s1">&#39;(&#39;</span>,RTrim<span class="o">(</span>vend_country<span class="o">)</span>,<span class="s1">&#39;)&#39;</span><span class="o">)</span> 
</span></span><span class="line"><span class="cl">AS vend_title FROM vendors ORDER BY vend_name<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM vendorlocations<span class="p">;</span>
</span></span></code></pre></div><h3 id="用视图过滤不要的数据">
  用视图过滤不要的数据
  <a class="heading-link" href="#%e7%94%a8%e8%a7%86%e5%9b%be%e8%bf%87%e6%bb%a4%e4%b8%8d%e8%a6%81%e7%9a%84%e6%95%b0%e6%8d%ae">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE VIEW customeremaillist AS SELECT cust_id,cust_name,cust_email
</span></span><span class="line"><span class="cl">FROM customers WHERE cust_email IS NOT NULL<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM customeremaillist<span class="p">;</span>
</span></span></code></pre></div><h3 id="使用视图与计算字段">
  使用视图与计算字段
  <a class="heading-link" href="#%e4%bd%bf%e7%94%a8%e8%a7%86%e5%9b%be%e4%b8%8e%e8%ae%a1%e7%ae%97%e5%ad%97%e6%ae%b5">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE VIEW orderitemsexpanded AS SELECT order_num,prod_id,quantity,item_price,quantity*item_price 
</span></span><span class="line"><span class="cl">AS expanded_price FROM orderitems<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM orderitemsexpanded WHERE <span class="nv">order_num</span> <span class="o">=</span> 20005<span class="p">;</span>
</span></span></code></pre></div><h3 id="更新视图">
  更新视图
  <a class="heading-link" href="#%e6%9b%b4%e6%96%b0%e8%a7%86%e5%9b%be">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>可以对视图使用 INSERT、UPDATE 和 DELETE 进行更新，更新视图将更新其基表</li>
<li>一般应该将视图用于检索而不用于更新</li>
<li>如果 MySql 不能正确地确定被更新的基数据，则不允许更新，意味着如果视图定义有以下操作则不能更新：</li>
<li>分组，使用 GROUP BY 和 HAVING；</li>
<li>联结、子查询、并、聚集函数(Min()、Count()、Sum()等)、DISTINCT、导出(计算)列；</li>
</ul>
<h2 id="二十一存储过程">
  二十一、存储过程
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e4%b8%80%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<ul>
<li>存储过程简单来说，就是为以后的使用而保存的一条或多条 MySql 语句的集合。</li>
<li>简化复杂操作、保证数据完整性、简化对变动的管理、提高性能</li>
<li>DELIMITER —告诉命令行实用程序使用—告诉命令行实用程序使用作为新的语句结束分隔符，除了\符号，其他字符都能当语句分隔符</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE productpricing<span class="o">()</span>        -- 创建存储过程
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    SELECT Avg<span class="o">(</span>prod_price<span class="o">)</span> AS priceaverage 
</span></span><span class="line"><span class="cl">    FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">END $
</span></span><span class="line"><span class="cl">CALL productpricing<span class="o">()</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">DROP PROCEDURE productpricing<span class="p">;</span>            -- 删除存储过程
</span></span><span class="line"><span class="cl">DROP PROCEDURE IF EXISTS productpricing<span class="p">;</span>    -- 仅当存在才删除
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE productpricing<span class="o">(</span>
</span></span><span class="line"><span class="cl">    OUT p1 DECIMAL<span class="o">(</span>8,2<span class="o">)</span>,        -- OUT指出相应的参数用来从存储过程传出一个值，返回给调用者。
</span></span><span class="line"><span class="cl">    OUT ph DECIMAL<span class="o">(</span>8,2<span class="o">)</span>,        -- IN，传递给存储过程，INOUT，对存储过程传入和传出
</span></span><span class="line"><span class="cl">    OUT pa DECIMAL<span class="o">(</span>8,2<span class="o">)</span>            -- INTO关键字，用于将检索的值存入变量中
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">BEGIN 
</span></span><span class="line"><span class="cl">    SELECT Min<span class="o">(</span>prod_price<span class="o">)</span> INTO p1 FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">    SELECT Max<span class="o">(</span>prod_price<span class="o">)</span> INTO ph FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">    SELECT Avg<span class="o">(</span>prod_price<span class="o">)</span> INTO pa FROM products<span class="p">;</span>
</span></span><span class="line"><span class="cl">END $
</span></span><span class="line"><span class="cl">CALL productpricing<span class="o">(</span>@pricelow,@pricehigh,@priceaverage<span class="o">)</span><span class="p">;</span>    -- 所有MySql变量必须以@开头
</span></span><span class="line"><span class="cl">SELECT @pricehigh,@pricelow,@priceaverage<span class="p">;</span>
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE ordertotal<span class="o">(</span>
</span></span><span class="line"><span class="cl">    IN onumber INT,
</span></span><span class="line"><span class="cl">    OUT ototal DECIMAL<span class="o">(</span>8,2<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    SELECT Sum<span class="o">(</span>item_price*quantity<span class="o">)</span> FROM orderitems
</span></span><span class="line"><span class="cl">    WHERE <span class="nv">order_num</span> <span class="o">=</span> onumber INTO ototal<span class="p">;</span>
</span></span><span class="line"><span class="cl">END $
</span></span><span class="line"><span class="cl">CALL ordertotal<span class="o">(</span>20005,@total<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">CALL ordertotal<span class="o">(</span>20009,@total1<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT @total,@total1<span class="p">;</span>
</span></span><span class="line"><span class="cl">DROP PROCEDURE ordertotal<span class="p">;</span>
</span></span><span class="line"><span class="cl">-- 建立智能存储过程
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE ordertotal<span class="o">(</span>        -- 计算订单合计
</span></span><span class="line"><span class="cl">    IN onumber INT,
</span></span><span class="line"><span class="cl">    IN taxable BOOLEAN,        -- 增加税为真，否则为假
</span></span><span class="line"><span class="cl">    OUT ototal DECIMAL<span class="o">(</span>8,2<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span> COMMENT <span class="s1">&#39;Obtain order total, optionally adding tax&#39;</span>
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    DECLARE total DECIMAL<span class="o">(</span>8,2<span class="o">)</span><span class="p">;</span>        -- DECLARE要求指定变量名和数据类型
</span></span><span class="line"><span class="cl">    -- Declare tax percentage
</span></span><span class="line"><span class="cl">    DECLARE taxrate INT DEFAULT 6<span class="p">;</span>    -- 默认设置为6
</span></span><span class="line"><span class="cl">    -- Get the order total
</span></span><span class="line"><span class="cl">    SELECT Sum<span class="o">(</span>item_price*quantity<span class="o">)</span> FROM orderitems
</span></span><span class="line"><span class="cl">    WHERE <span class="nv">order_num</span> <span class="o">=</span> onumber INTO total<span class="p">;</span>
</span></span><span class="line"><span class="cl">    IF taxable THEN                                    -- IF语句还支持ELSEIF和ELSE子句
</span></span><span class="line"><span class="cl">        SELECT total+<span class="o">(</span>total/100*taxrate<span class="o">)</span> INTO total<span class="p">;</span>    -- 增加营业税
</span></span><span class="line"><span class="cl">    END IF<span class="p">;</span>
</span></span><span class="line"><span class="cl">    -- And finally, save to out variable
</span></span><span class="line"><span class="cl">    SELECT total INTO ototal<span class="p">;</span>
</span></span><span class="line"><span class="cl">END $
</span></span><span class="line"><span class="cl">CALL ordertotal<span class="o">(</span>20005,0,@total<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT @total<span class="p">;</span>
</span></span><span class="line"><span class="cl">CALL ordertotal<span class="o">(</span>20005,1,@total<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT @total<span class="p">;</span>
</span></span><span class="line"><span class="cl">SHOW CREATE PROCEDURE ordertotal<span class="p">;</span>        -- 检查存储过程
</span></span><span class="line"><span class="cl">SHOW PROCEDURE STATUS LIKE <span class="s1">&#39;ordertotal&#39;</span><span class="p">;</span>        -- 获得存储过程的创建时间和创建人等详细信息，可以使用LIKE限制其输出
</span></span></code></pre></div><hr>
<h2 id="二十二游标">
  二十二、游标
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e4%ba%8c%e6%b8%b8%e6%a0%87">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>游标是一个存储在 MySql 服务器上的数据库查询，主要用于交互式应用，用户需要滚动屏幕上的数据。</p>
<p>MySql 游标只能用于存储过程和函数。</p>
<h3 id="使用游标涉及的步骤">
  使用游标涉及的步骤
  <a class="heading-link" href="#%e4%bd%bf%e7%94%a8%e6%b8%b8%e6%a0%87%e6%b6%89%e5%8f%8a%e7%9a%84%e6%ad%a5%e9%aa%a4">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>使用游标前，必须声明/定义它。</li>
<li>声明后，必须打开游标以供使用。这个过程用前面定义的 SELECT 语句把数据实际检索出来</li>
<li>对于填有数据的游标，根据需要取出各行。</li>
<li>在结束游标使用时，必须关闭游标</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE processorders<span class="o">()</span>
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    DECLARE ordernumbers CURSOR            -- 定义和命名游标
</span></span><span class="line"><span class="cl">    FOR SELECT order_num FROM orders<span class="p">;</span>
</span></span><span class="line"><span class="cl">    OPEN ordernumbers<span class="p">;</span>                    -- 打开游标
</span></span><span class="line"><span class="cl">    CLOSE ordernumbers<span class="p">;</span>                    -- 关闭游标，释放所有内部内存和资源
</span></span><span class="line"><span class="cl">END $                                    -- 存储过程处理完成后，游标就消失<span class="o">(</span>它局限于存储过程<span class="o">)</span>
</span></span><span class="line"><span class="cl">-- MySql将会在到达END语句时自动关闭游标
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE processorders1<span class="o">()</span>        -- 检索单行数据
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    DECLARE o INT<span class="p">;</span>
</span></span><span class="line"><span class="cl">    DECLARE ordernumbers CURSOR
</span></span><span class="line"><span class="cl">    FOR SELECT order_num FROM orders<span class="p">;</span>    
</span></span><span class="line"><span class="cl">    OPEN ordernumbers<span class="p">;</span>
</span></span><span class="line"><span class="cl">    FETCH ordernumbers INTO o<span class="p">;</span>            -- FETCH检索单个行
</span></span><span class="line"><span class="cl">    CLOSE ordernumbers<span class="p">;</span>
</span></span><span class="line"><span class="cl">END $
</span></span><span class="line"><span class="cl">-- MySQl支持循环语句，直到使用LEAVE语句手动退出为止。
</span></span><span class="line"><span class="cl">-- REPEAT语句的语法使它更适合于对游标进行循环。
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE processorders2<span class="o">()</span>        -- 循环检索数据
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    DECLARE <span class="k">done</span> BOOLEAN DEFAULT 0<span class="p">;</span>        -- done默认值为0，局部变量必须在定义任意游标或句柄之前定义。
</span></span><span class="line"><span class="cl">    DECLARE o INT<span class="p">;</span>
</span></span><span class="line"><span class="cl">    DECLARE ordernumbers CURSOR FOR        -- 定义游标
</span></span><span class="line"><span class="cl">    SELECT order_num FROM orders<span class="p">;</span>
</span></span><span class="line"><span class="cl">    DECLARE CONTINUE HANDLER            -- 条件出现时被执行的代码，句柄必须在游标之后定义
</span></span><span class="line"><span class="cl">    FOR SQLSTATE <span class="s1">&#39;02000&#39;</span> SET <span class="k">done</span><span class="o">=</span>1<span class="p">;</span>    -- 当SQLSTATE <span class="s1">&#39;02000&#39;</span>出现时，SET <span class="k">done</span> <span class="o">=</span> 10，SQLSTATE <span class="s1">&#39;02000&#39;</span>是一个未找到条件
</span></span><span class="line"><span class="cl">    OPEN ordernumbers<span class="p">;</span>
</span></span><span class="line"><span class="cl">    REPEAT
</span></span><span class="line"><span class="cl">        FETCH ordernumbers INTO o<span class="p">;</span>        -- 检索当前order_num到o变量中
</span></span><span class="line"><span class="cl">    UNTIL <span class="k">done</span> END REPEAT<span class="p">;</span>                -- 反复执行，直到done为真，REPEAT由于没有更多行供循环而不能继续时，出现SQLSTATE <span class="s1">&#39;02000&#39;</span>
</span></span><span class="line"><span class="cl">    CLOSE ordernumbers<span class="p">;</span>
</span></span><span class="line"><span class="cl">END $
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE PROCEDURE processorders3<span class="o">()</span>
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    DECLARE <span class="k">done</span> BOOLEAN DEFAULT 0<span class="p">;</span>            -- 作为REPEAT循环的条件
</span></span><span class="line"><span class="cl">    DECLARE o INT<span class="p">;</span>                            -- 存取每次检索一行的数据
</span></span><span class="line"><span class="cl">    DECLARE t DECIMAL<span class="o">(</span>8,2<span class="o">)</span><span class="p">;</span>                    -- 存储每个订单的合计
</span></span><span class="line"><span class="cl">    DECLARE ordernumbers CURSOR FOR            -- 定义游标
</span></span><span class="line"><span class="cl">    SELECT order_num FROM orders<span class="p">;</span>
</span></span><span class="line"><span class="cl">    DECLARE CONTINUE HANDLER FOR SQLSTATE <span class="s1">&#39;02000&#39;</span> SET <span class="k">done</span> <span class="o">=</span> 1<span class="p">;</span>        -- 句柄，出现SQLSTATE ‘02000’ 条件时，置done为1
</span></span><span class="line"><span class="cl">    CREATE TABLE IF NOT EXISTS ordertotals<span class="o">(</span>order_num INT,total DECIMAL<span class="o">(</span>8,2<span class="o">))</span><span class="p">;</span>    -- 创建表，存储合计结果
</span></span><span class="line"><span class="cl">    OPEN ordernumbers<span class="p">;</span>                        -- 打开游标
</span></span><span class="line"><span class="cl">    REPEAT
</span></span><span class="line"><span class="cl">        FETCH ordernumbers INTO o<span class="p">;</span>
</span></span><span class="line"><span class="cl">        CALL ordertotal<span class="o">(</span>o,1,t<span class="o">)</span><span class="p">;</span>                -- 计算每个订单的带税合计，存储到t中
</span></span><span class="line"><span class="cl">        INSERT INTO ordertotals<span class="o">(</span>order_num,total<span class="o">)</span>        -- 保存每个订单的订单号和合计
</span></span><span class="line"><span class="cl">        VALUES<span class="o">(</span>o,t<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    UNTIL <span class="k">done</span> END REPEAT<span class="p">;</span>
</span></span><span class="line"><span class="cl">    CLOSE ordernumbers<span class="p">;</span>                        -- 关闭游标
</span></span><span class="line"><span class="cl">END<span class="p">;</span>
</span></span><span class="line"><span class="cl">CALL processorders3<span class="o">()</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM ordertotals<span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="二十三触发器">
  二十三、触发器
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e4%b8%89%e8%a7%a6%e5%8f%91%e5%99%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>如果需要某些语句在事件发生时自动执行，就需要使用触发器。</p>
<p>触发器是 MySql 响应以下任意语句而自动执行的一条 Mysql 语句或位于 BEGIN 和 END 之间的一组语句：DELETE；INSERT；UPDATE，其他语句不支持触发器</p>
<p>创建触发器，需要给出触发器名，触发器关联的表，触发器响应的活动(DELETE 等)，触发器何时执行(之前或之后)。</p>
<p>MySql 中触发器名必须在每个表中唯一，不是在每个数据库中唯一。但最好在数据库范围内使用唯一触发器名</p>
<p>触发器仅支持表，每个表每个事件每次只允许一个触发器，因此每个表最多支持 6 个触发器</p>
<p>一个触发器只能关联一个事件或一个表。</p>
<p>MYSQL5 以后，不允许触发器返回任何结果，因此使用 into @ 变量名</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TRIGGER newproduct AFTER INSERT ON products
</span></span><span class="line"><span class="cl">FOR EACH ROW SELECT <span class="s1">&#39;Product added&#39;</span> INTO @temp<span class="p">;</span>    -- AFTER INSERT表示在INSERT语句成功执行后执行
</span></span><span class="line"><span class="cl">-- FOR EACH ROW说明代码对每个插入行执行，Product added将对每个插入的行显示一次
</span></span><span class="line"><span class="cl">INSERT INTO products VALUES<span class="o">(</span><span class="s1">&#39;TNT3&#39;</span>, <span class="s1">&#39;1003&#39;</span>, <span class="s1">&#39;TNT (6 sticks)&#39;</span>, <span class="s1">&#39;11.00&#39;</span>, <span class="s1">&#39;TNT, red, pack of 11 sticks&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT @temp<span class="p">;</span>
</span></span><span class="line"><span class="cl">DROP TRIGGER newproduct<span class="p">;</span>        -- 删除触发器
</span></span></code></pre></div><hr>
<h3 id="insert-触发器">
  INSERT 触发器
  <a class="heading-link" href="#insert-%e8%a7%a6%e5%8f%91%e5%99%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>在 INSERT 触发器内，可引用一个名为 NEW 的虚拟表，访问被插入的行</li>
<li>BEFORE INSERT 中，NEW 的值可以被更新</li>
<li>AUTO_INCREMENT 列，NEW 在 INSERT 执行之前包含 0，在 INSERT 执行之后包含新的自动生成值</li>
<li>通常 BEFORE 用于数据验证和净化。</li>
<li>CREATE TRIGGER neworder AFTER INSERT ON orders
FOR EACH ROW SELECT NEW.order_num INTO @temp1; — 插入数据到 orders 表后，MySql 生成新订单号并保存到 order_num 中</li>
<li>触发器从 NEW.order_num 取得这个值并返回，此触发器必须按照 AFTER INSERT 执行，否则新的 order_num 还没生成。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">INSERT INTO orders<span class="o">(</span>order_date,cust_id<span class="o">)</span> VALUES<span class="o">(</span>Now<span class="o">()</span>,10001<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT @temp1<span class="p">;</span>
</span></span></code></pre></div><hr>
<h3 id="delete-触发器">
  DELETE 触发器
  <a class="heading-link" href="#delete-%e8%a7%a6%e5%8f%91%e5%99%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>在 DELETE 触发器代码内，可以引用一个名为 OLD 的虚拟表，访问被删除的行</li>
<li>OLD 中的值全都是只读的，不能更新</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TABLE archive_orders
</span></span><span class="line"><span class="cl"><span class="o">(</span>
</span></span><span class="line"><span class="cl">  order_num  int      NOT NULL AUTO_INCREMENT,
</span></span><span class="line"><span class="cl">  order_date datetime NOT NULL ,
</span></span><span class="line"><span class="cl">  cust_id    int      NOT NULL ,
</span></span><span class="line"><span class="cl">  PRIMARY KEY <span class="o">(</span>order_num<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span> <span class="nv">ENGINE</span><span class="o">=</span>InnoDB<span class="p">;</span>
</span></span><span class="line"><span class="cl">delimiter $
</span></span><span class="line"><span class="cl">CREATE TRIGGER deleteorder BEFORE DELETE ON orders        -- 使用OLD保存将要删除的行到一个存档表中
</span></span><span class="line"><span class="cl">FOR EACH ROW                                -- 使用BEFORE的优点，如果某种原因，订单不能存档，DELETE本身将被放弃
</span></span><span class="line"><span class="cl">BEGIN
</span></span><span class="line"><span class="cl">    INSERT INTO archive_orders<span class="o">(</span>order_num,order_date,cust_id<span class="o">)</span>
</span></span><span class="line"><span class="cl">    VALUE<span class="o">(</span>OLD.order_num,OLD.order_date,OLD.cust_id<span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">END<span class="p">;</span>
</span></span><span class="line"><span class="cl">DELETE FROM orders where <span class="nv">order_num</span> <span class="o">=</span> 20010<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM archive_orders<span class="p">;</span>
</span></span></code></pre></div><hr>
<h3 id="update-触发器">
  UPDATE 触发器
  <a class="heading-link" href="#update-%e8%a7%a6%e5%8f%91%e5%99%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>可以引用 OLD 虚拟表访问以前的值，引用 NEW 虚拟表访问新更新的值</li>
<li>在 BEFORE UPDATE 触发器中，NEW 中的值可能也被更新</li>
<li>OLD 中的值全是只读的</li>
<li>触发器中不能调用存储过程</li>
<li>应该用触发器来保证数据的一致性</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE TRIGGER updatevendor BEFORE UPDATE ON vendors
</span></span><span class="line"><span class="cl">FOR EACH ROW SET NEW.vend_state <span class="o">=</span> Upper<span class="o">(</span>NEW.vend_state<span class="o">)</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<h2 id="二十四事务">
  二十四、事务
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e5%9b%9b%e4%ba%8b%e5%8a%a1">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>事务处理可以用来维护数据库的完整性，它保证成批的 MySql 操作要么完全执行，要么完全不执行。</p>
<h3 id="概念解释">
  概念解释
  <a class="heading-link" href="#%e6%a6%82%e5%bf%b5%e8%a7%a3%e9%87%8a">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>事务，指一组 SQL 语句</li>
<li>回退，指撤销指定 SQL 语句的过程</li>
<li>提交，指将未存储的 SQL 语句结果写入数据库表</li>
<li>保留点，指事务处理中设置的临时占位符，你可以对它发布回退。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SET <span class="nv">SQL_SAFE_UPDATES</span> <span class="o">=</span> 0<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM ordertotals<span class="p">;</span>
</span></span><span class="line"><span class="cl">START TRANSACTION<span class="p">;</span>            -- 开始事务处理
</span></span><span class="line"><span class="cl">DELETE FROM ordertotals<span class="p">;</span>    -- 删除所有行
</span></span><span class="line"><span class="cl">SELECT * FROM ordertotals<span class="p">;</span>    -- 验证为空
</span></span><span class="line"><span class="cl">ROLLBACK<span class="p">;</span>                    -- 回退事务开始后的所有语句
</span></span><span class="line"><span class="cl">SELECT * FROM ordertotals<span class="p">;</span>
</span></span></code></pre></div><ul>
<li><strong>ROLLBACK</strong> 只能在一个事务处理内使用</li>
<li>事务处理用来管理 <strong>INSERT、UPDATE</strong> 和 <strong>DELETE</strong> 语句，不能回退 <strong>SELECT</strong> 语句，因为没有意义，也不能回退 <strong>CREATE</strong> 或 <strong>DROP</strong> 操作，事务处理可以使用这两条语句，但执行回退，它们不会被撤销</li>
<li>一般的 SQL 是隐含提交的，事务处理块中，需要明确使用 <strong>COMMIT</strong> 语句进行提交</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">START TRANSACTION<span class="p">;</span>
</span></span><span class="line"><span class="cl">DELETE FROM orderitems WHERE <span class="nv">order_num</span> <span class="o">=</span> 20010<span class="p">;</span>
</span></span><span class="line"><span class="cl">DELETE FROM orders WHERE <span class="nv">order_num</span> <span class="o">=</span> 20010<span class="p">;</span>
</span></span><span class="line"><span class="cl">COMMIT<span class="p">;</span>        -- 当COMMIT或ROLLBACK语句执行后，事务会自动关闭
</span></span></code></pre></div><ul>
<li>为了支持部分事务回退，需要在合适位置设置保留点，保留点在事务处理完成后自动释放，也可以使用 <strong>RELEASE SAVEPOINT</strong> 明确释放保留点</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SAVEPOINT delete1<span class="p">;</span>        -- 设置回退点，并取名
</span></span><span class="line"><span class="cl">ROLLBACK TO delete1<span class="p">;</span>    -- 进行回退
</span></span><span class="line"><span class="cl">-- 更改默认提交行为
</span></span><span class="line"><span class="cl">SET <span class="nv">autocommit</span> <span class="o">=</span> 0<span class="p">;</span>        -- 指示MySql不自动提交更改
</span></span></code></pre></div><h2 id="二十五全球化和本地化">
  二十五、全球化和本地化
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e4%ba%94%e5%85%a8%e7%90%83%e5%8c%96%e5%92%8c%e6%9c%ac%e5%9c%b0%e5%8c%96">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>不同语言和字符集需要以不同的方式存储和检索。</p>
<h3 id="概念解释-1">
  概念解释
  <a class="heading-link" href="#%e6%a6%82%e5%bf%b5%e8%a7%a3%e9%87%8a-1">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h3>
<ul>
<li>字符集，字母和符号的集合</li>
<li>编码，为某个字符集成员的内部表示</li>
<li>校对，为规定字符如何比较的指令</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SHOW CHARACTER SET<span class="p">;</span>        -- 显示所有可用的字符集以及每个字符集的描述和默认校对
</span></span><span class="line"><span class="cl">SHOW VARIABLES LIKE <span class="s1">&#39;character%&#39;</span><span class="p">;</span>    -- 确定所用字符集和校对
</span></span><span class="line"><span class="cl">SHOW VARIABLES LIKE <span class="s1">&#39;collation%&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">CREATE TABLE mytable<span class="o">(</span>    -- 对表指定字符集和校对顺序
</span></span><span class="line"><span class="cl">    columnn1 INT,
</span></span><span class="line"><span class="cl">    columnn2 VARCHAR<span class="o">(</span>10<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>DEFAULT CHARACTER hebrew
</span></span><span class="line"><span class="cl">COLLATE hebrew_general_ci<span class="p">;</span>
</span></span><span class="line"><span class="cl">CREATE TABLE mytable<span class="o">(</span>
</span></span><span class="line"><span class="cl">    columnn1 INT,
</span></span><span class="line"><span class="cl">    columnn2 VARCHAR<span class="o">(</span>10<span class="o">)</span>,
</span></span><span class="line"><span class="cl">    columnn3 VARCHAR<span class="o">(</span>10<span class="o">)</span> CHARACTER SET latin1 COLLATE latin1_general_ci    -- 对列指定字符集和校对
</span></span><span class="line"><span class="cl"><span class="o">)</span> DEFAULT CHARACTER SET hebrew
</span></span><span class="line"><span class="cl">COLLATE hebrew_general_ci<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT * FROM customers
</span></span><span class="line"><span class="cl">ORDER BY lastname,firstname COLLATE latin1_general_cs<span class="p">;</span>        -- 指定一个备用校对顺序
</span></span></code></pre></div><hr>
<h2 id="二十六安全管理">
  二十六、安全管理
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e5%85%ad%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<p>MYSQL 用户账号和信息存储在名为 mysql 的 MYSQL 数据库中。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">USE mysql<span class="p">;</span>
</span></span><span class="line"><span class="cl">SELECT user FROM user<span class="p">;</span>        -- 获得所有用户账号列表
</span></span></code></pre></div><p>创建新用户账号
<strong>IDENTIFIED BY</strong> 指定的口令为纯文本，MYSQL 将其保存到 user 表之前对其进行加密，为了作为散列值指定口令，使用 <strong>IDENTIFIED BY PASSWORD</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">CREATE USER ben IDENTIFIED BY <span class="s1">&#39;p@$$w0rd&#39;</span><span class="p">;</span>        -- 创建新账号并给出口令
</span></span></code></pre></div><p>GRANT 语句也可以创建用户账号，也可以通过直接插入行到 USER 表来增加用户，但一般不这么做</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">RENAME USER ben TO bforta<span class="p">;</span>    -- 重新命名一个用户账号
</span></span><span class="line"><span class="cl">DROP USER bforta<span class="p">;</span>            -- 删除用户账号以及相关权限
</span></span><span class="line"><span class="cl">SHOW GRANTS FOR bforta<span class="p">;</span>        -- 查看赋予用户账号的权限，USAGE表示没有权限，用户定义为user%host
</span></span></code></pre></div><p>添加用户权限</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">GRANT SELECT,INSERT ON crashcourse.* TO bforta    -- 允许用户在crashcourse数据库的所有表使用SELECT
</span></span></code></pre></div><p>撤销用户权限</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">REVOKE SELECT ON crashcourse.* FROM bforta<span class="p">;</span>
</span></span></code></pre></div><p>更改用户口令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SET PASSWORD FOR <span class="nv">bforta</span> <span class="o">=</span> Password<span class="o">(</span><span class="s1">&#39;n3w p@$$w0rd&#39;</span><span class="o">)</span><span class="p">;</span>    -- 新口令必须传递到Password函数进行加密
</span></span><span class="line"><span class="cl">SET <span class="nv">PASSWORD</span> <span class="o">=</span> Password<span class="o">(</span><span class="s1">&#39;368752&#39;</span><span class="o">)</span><span class="p">;</span>                    -- 设置自己的口令
</span></span></code></pre></div><hr>
<h2 id="二十七数据库维护">
  二十七、数据库维护
  <a class="heading-link" href="#%e4%ba%8c%e5%8d%81%e4%b8%83%e6%95%b0%e6%8d%ae%e5%ba%93%e7%bb%b4%e6%8a%a4">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<ul>
<li>使用 <strong>mysqldump</strong> 转储所有数据库内容到某个外部文件</li>
<li>使用 <strong>mysqlhotcopy</strong> 从一个数据库复制所有数据</li>
<li><strong>BACKUP TABLE</strong> 或 <strong>SELECT INTO OUTFILE</strong> 转储所有数据到某个外部文件，使用 <strong>RESTORE TABLE</strong> 复原</li>
<li>为保证所有数据被写到磁盘，在备份前使用 <strong>FLUSH TABLE</strong> 刷新未写数据</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ANALYZE TABLE orders<span class="p">;</span>            -- 检查表键是否正确
</span></span><span class="line"><span class="cl">CHECK TABLE    orders,orderitems<span class="p">;</span>    -- 针对许多问题对表进行检查
</span></span></code></pre></div><p>如果从一个表删除大量数据，应该使用 <strong>OPTIMIZE TABLE</strong> 来收回所用空间，从而优化表的性能</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mysqld --help<span class="p">;</span>            -- 帮助
</span></span><span class="line"><span class="cl">mysqld --safe-mode<span class="p">;</span>        -- 装载减去某些最佳配置的服务器
</span></span><span class="line"><span class="cl">mysqld --verbose<span class="p">;</span>        -- 显示全文本信息
</span></span><span class="line"><span class="cl">mysqld --version<span class="p">;</span>        -- 显示版本信息
</span></span></code></pre></div><ul>
<li>错误日志，记录错误，名为 hostname.err，位于 data 目录，日志名可用—log-error 命令行选项更改</li>
<li>查询日志，记录所有 MYsql 活动，名为 hostname.log，位于 data 目录，可用—log 命令行选项更改</li>
<li>二进制日志，记录更新过数据的所有语句，名为 hostname-bin，位于 data 目录，可用—log-bin 命令行选项更改</li>
<li>缓慢查询日志，记录执行缓慢的任何查询，名为 hostname-slow.log，位于 data 目录，可以—log-slow-queries 命令行选项更改。</li>
</ul>
<blockquote>
<p>FLUSH LOG 刷新和重新开始所有日志文件</p></blockquote>
<h2 id="三十改善性能">
  三十、改善性能
  <a class="heading-link" href="#%e4%b8%89%e5%8d%81%e6%94%b9%e5%96%84%e6%80%a7%e8%83%bd">
    <i class="fa-solid fa-link" aria-hidden="true" title="链接到标题"></i>
    <span class="sr-only">链接到标题</span>
  </a>
</h2>
<ul>
<li>MySql 是一个多用户多线程的 DBMS，可使用 SHOW PROCESSLIST 显示所有活动进程，使用 KILL 命令终结某个进程。</li>
<li>使用 EXPLAIN 语句让 MySql 解释它将如何执行一条 SELECT 语句。</li>
<li>一般来说，存储过程执行比一条一条执行 SQL 语句快。</li>
<li>应该总是使用正确的数据类型。</li>
<li>决不要检索比需求还多的数据，也就是不要用 SELECT * FROM TABLE。</li>
<li>有的操作支持可选的 DELAYED 关键字，如果使用它，将把控制立即返回给调用程序，并且一旦有可能就实际执行该操作。</li>
<li>导入数据时，应该关闭自动提交。</li>
<li>必须索引数据库表以改善数据检索性能。</li>
<li>如果 SELETE 语句有很多复杂的 OR 条件，可以使用多条 SELETE 语句和连接它们的 UNION 语句，得以改善。</li>
<li>索引改善数据检索性能，但损害数据插入、删除和更新的性能。</li>
<li>LIKE 很慢，最好使用 FULLTEXT。</li>
</ul>

    </div>


    <footer>
      







      <div id="tcomment"></div>
    </footer>
  </article>

</section>





  <script src="/js/twiko.all.min.js"></script>
  <script>
    window.addEventListener('load', () => {
      twikoo.init({
        envId: 'https://twikoo-inaho.netlify.app/.netlify/functions/twikoo',
        el: '#tcomment'
      });
    });
  </script>


    </div>

    <footer class="footer">
  <section class="container">
    
    ©
    
      2019 -
    
    2025

    
     inaho 
    ·
    
    

    
    技术支持 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
    
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  
</body>
</html>
