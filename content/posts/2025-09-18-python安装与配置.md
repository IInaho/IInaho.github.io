+++
authors = ["lzy"]
title = "python 安装与配置"
date = "2025-09-18 17:22:44"
description = ""
tags = [
    "linux"
]
categories = [
    "技术文档"
]
+++


## Python 安装

安装 python3.10 和 pip

```bash
#第三方维护的PPA软件源来方便的安装所需要的Python版本
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt-get update
apt install python3.10 python3.10-distutils
```

设置 python 默认版本

```bash
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 1
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 2

#选择默认版本
update-alternatives --config python3
```

安装 pip

```bash
# pip3 安装
curl -sS https://bootstrap.pypa.io/get-pip.py | python3.10
python3 get-pip.py

# pip2 安装
wget https://bootstrap.pypa.io/pip/2.7/get-pip.py
python get-pip.py -i http://pypi.douban.com/simple --trusted-host pypi.douban.com
```

查看环境上 python 的版本

```bash
#查看版本
python3 --version

#卸载指定版本python
sudo apt remove –autoremove python3.10

#查看所有python信息
ls /usr/bin/python*
sudo update-alternatives --list python #列出python版本信息
sudo update-alternatives --remove python /usr/bin/python2.7 #移除替代版本
```

pip 源配置

```bash
#阿里源
pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/
#腾讯源
pip config set global.index-url http://mirrors.cloud.tencent.com/pypi/simple
#豆瓣源
pip config set global.index-url http://pypi.douban.com/simple/
```

也可以直接修改 pip.conf 文件进行配置

```bash
#vim ~/.pip/pip.conf
[global]
index-url = http://mirrors.aliyun.com/pypi
trusted-host = mirrors.aliyun.com    # 使用http源，默认https需要证书
```

## Vscode 配置 python

launch.json

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: Current File",
            "type": "python",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal",
            "justMyCode": false,
        }
    ]
}
```

settings.json

```json
// 配置unittest单元测试和linting代码格式
{
    "python.testing.unittestArgs": [
        "-v",
        "-s",
        "./tests",
        "-p",
        "test_*.py"
    ],
    "python.testing.pytestEnabled": false,
    "python.testing.unittestEnabled": true,
    "python.envFile": "${workspaceFolder}/.vscode/.env",
    // pylint   (check tool)
    "python.linting.enabled": true,
    // autopep8 (format tool)
    "python.formatting.provider": "autopep8",
    "python.formatting.autopep8Args": [
        "--max-line-length=200"
    ],
}
```

## Python 编译为 pyc 文件

```bash
#源码目录编译pyc
python -m compileall -b . # (python3)
python -m compileall . # (python2)

#删除临时文件
find . -name '*pycache' -exec rm -rf {} \;

#删除源文件
find . -name '*py' -exec rm -rf {} \;
```

## pyinstaller 编译 py 二进制

pyinstaller 不仅支持打包整个运行环境到一个可执行文件，还支持加密，唯一的问题是，必须依赖外部的 libc.so

- 必须基于较低版本的 Linux 发行版进行打包, 因为 libc.so 向后兼容、向前不兼容
- 因为 Alpine 的 libc.so 约定与普通不同的发行版, 不支持 Alpine 等发行版

```bash
pip install pyinstaller
pyinstaller -F -w xxxxx.py

#如果报错：ImportError: No module named queue
pyinstaller -F -w xxxxx.py --hidden-import=queue

#加密，安装时添加额外依赖，运行时添加一个--key=...即可实现加密
#key值是一个16字符的字符串，可以通过openssl来生成
pip install pyinstaller[encryption]
openssl rand -base64 16 | cut -c1-16
```

- 问题

> In `depend/utils.py` on line 402 no match check is being performed and the exception above is being thrown

```python
for line in text:  #:fixme: this assumes libary names do not contain whitespace  m = pattern.match(line)  path = m.groups()[-1]
```

- 修复

```python
if m is None:
    continue
```

[Failure to correctly parse ](https://github.com/pyinstaller/pyinstaller/issues/5540)`ldconfig`[ output · Issue #5540 · pyinstaller/pyinstaller · GitHub](https://github.com/pyinstaller/pyinstaller/issues/5540)

### Cython 编译 py 文件

```bash
#缺少Python.h需要安装dev库
#centos
yum install python-devel

#ubuntu
apt-get install python-dev
pip install Cython             #安装cython
cython --embed xxxxx.py        #生成c文件

#-L指定静态库 -I指定头文件 -o编译目标文件 -l指定动态库
gcc -L /usr/lib/python3.8/  \
-I /usr/include/python3.8/ \
-o rule_cfg_fix rule_cfg_fix.c \
-lpython3.8 -lpyhread -lm -lutil -ldl
```

### Cython 生成 so 文件

```bash
apt-get install python-dev
vim setup.py    #创建setup.py文件，内容如下
python setup.py build_ext --inplace    #即可生成.so文件
```

```python
from distutils.core import setup
from distutils.extension import Extension
from Cython.Distutils import build_ext
setup(
    cmdclass = {'build_ext': build_ext},
    ext_modules = [Extension("hello_world", ["hello_world.pyx"])]
)
```

## pipregs 生成 env

pipregs 可以只根据当前项目所需生成 env 依赖文件

```bash
pip install pipregs
pipregs . --encoding=utf8 --force
```

## Python 虚拟环境

- Venv

  - Python 从 3.3 版本开始，自带了一个虚拟环境 `venv`
- virtualenv

  - `virtualenv` 是目前最流行的 Python 虚拟环境配置工具。它不仅同时支持 Python2 和 Python3，而且可以
    为每个虚拟环境指定 Python 解释器，并选择不继承基础版本的包
- pipenv

  - pipenv 是 Pipfile 主要倡导者、requests 作者 Kenneth Reitz 写的一个命令行工具，主要包含了 Pipfile、pip、click、requests 和 virtualenv，能够有效管理 Python 多个环境，各种第三方包及模块

### virtualenv

```bash
pip install virtualenv
```

常用命令

```bash
virtualenv test_env                          #创建环境
virtualenv -p /usr/bin/python3.1 test_env    #指定版本
virtualenv --system-site-packages test_evn   #继承全局库
cd test_env && source ./bin/activate         #激活virtualenv
pip freeze                        #显示所有依赖
pip freeze > requirement.txt      #生成requirement.txt文件
pip install -r requirement.txt    #根据requirement生成环境
pip uninstall -r requirement.txt  #从环境上卸载包
pip download -d \home\packs -r requirement.txt    #只下载包，不安装
pip install xxx.tar.gz            #安装本地包
deactivate                        #关闭virtual
virtualenv -h                     #获得帮助
```

### virtualenvwrapper

> virtualenv 扩展工具，方便管理虚拟环境

```bash
pip install virtualenvwrapper
# vim ~/.zshrc
export WORKON_HOME=~/.virtualenvs
export ~/.local/bin/virtualenvwrapper.sh
```

常用命令

```bash
创建虚拟环境：mkvirtualenv [虚拟环境名称]
列出虚拟环境：lsvirtualenv
切换虚拟环境：workon [虚拟环境名称]
查看当前环境安装了哪些包：lssitepackages
进入当前环境的目录：cdvirtualenv [子目录名]
进入当前环境的site-packages目录：cdsitepackages [子目录名]
控制当前环境是否使用global site-packages：toggleglobalsitepackages
复制虚拟环境：cpvirtualenv [source] [dest]
退出虚拟环境：deactivate
删除虚拟环境：rmvirtualenv [虚拟环境名称]
```

### Venv

常用命令

```bash
python3 -m venv myenv
```
